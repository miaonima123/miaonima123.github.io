<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>webpack初学使用 | My Web Blog</title><meta name="keywords" content="打包工具,webpack"><meta name="author" content="Mc,1148567490@qq.com"><meta name="copyright" content="Mc"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="官网文档 webpack 安装 yarn init -y yarn add webpack webpack-cli -D     [D代表开发时依赖] 默认可以使用npx webpack命令进行打包 linux命令： rm -rf [build] 删除某个文件">
<meta property="og:type" content="article">
<meta property="og:title" content="webpack初学使用">
<meta property="og:url" content="https://mcweblog.com/2019/06/14/webpack%E5%88%9D%E5%AD%A6%E4%BD%BF%E7%94%A8/index.html">
<meta property="og:site_name" content="My Web Blog">
<meta property="og:description" content="官网文档 webpack 安装 yarn init -y yarn add webpack webpack-cli -D     [D代表开发时依赖] 默认可以使用npx webpack命令进行打包 linux命令： rm -rf [build] 删除某个文件">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://miaochen.mcweblog.com/img%2Fwq5m26.png">
<meta property="article:published_time" content="2019-06-14T14:00:22.000Z">
<meta property="article:modified_time" content="2022-05-19T13:11:15.876Z">
<meta property="article:author" content="Mc">
<meta property="article:tag" content="打包工具">
<meta property="article:tag" content="webpack">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://miaochen.mcweblog.com/img%2Fwq5m26.png"><link rel="shortcut icon" href="https://miaochen.mcweblog.com/img%2Ffav.png"><link rel="canonical" href="https://mcweblog.com/2019/06/14/webpack%E5%88%9D%E5%AD%A6%E4%BD%BF%E7%94%A8/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?9674ba6a680d75df31ead929ddeeae4e";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'webpack初学使用',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-05-19 21:11:15'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.1"><link rel="alternate" href="/atom.xml" title="My Web Blog" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://miaochen.mcweblog.com/img%2F2020_09_11_22_32_IMG_6232.JPG" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">20</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">19</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://miaochen.mcweblog.com/img%2Fwq5m26.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">My Web Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">webpack初学使用<a class="post-edit-link" href="null_posts/webpack初学使用.md" title="编辑" target="_blank"><i class="fas fa-pencil-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2019-06-14T14:00:22.000Z" title="发表于 2019-06-14 22:00:22">2019-06-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-05-19T13:11:15.876Z" title="更新于 2022-05-19 21:11:15">2022-05-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/">前端开发</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">15.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>76分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="webpack初学使用"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p><a target="_blank" rel="noopener" href="https://www.webpackjs.com/concepts/">官网文档</a></p>
<h2 id="webpack-安装"><a href="#webpack-安装" class="headerlink" title="webpack 安装"></a>webpack 安装</h2><ul>
<li><strong>yarn init -y</strong></li>
<li><strong>yarn add webpack webpack-cli -D</strong>     [D代表开发时依赖]</li>
<li>默认可以使用npx webpack命令进行打包</li>
<li>linux命令： rm -rf [build] 删除某个文件<span id="more"></span></li>
</ul>
<h2 id="手动配置webpack"><a href="#手动配置webpack" class="headerlink" title="手动配置webpack"></a>手动配置webpack</h2><ul>
<li>默认配置文件的名字 webpack.config.js</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack 是node写出来的 node的写法来运行</span></span><br><span class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)  <span class="comment">//内置模块无需安装这个模块可以将相对路径转化为绝对路径</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">mode</span>:<span class="string">&quot;development&quot;</span>,<span class="comment">//模式 默认两种 production development  生产和开发</span></span><br><span class="line">    <span class="attr">entry</span>:<span class="string">&quot;./src/index.js&quot;</span>,    <span class="comment">//入口</span></span><br><span class="line">    <span class="attr">output</span>:&#123;</span><br><span class="line">        <span class="attr">filename</span>:<span class="string">&quot;bundle.js&quot;</span>,   <span class="comment">//打包后的js的文件名</span></span><br><span class="line">        <span class="attr">path</span>:path.<span class="title function_">resolve</span>(__dirname,<span class="string">&quot;build&quot;</span>),<span class="comment">//路径必须是一个绝对路径 加上dirname代表当前目录下生成一个dist文件夹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>配置package.json文件启动项</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;build&quot;</span>:<span class="string">&quot;webpack --config webpack.config.js&quot;</span>  <span class="comment">//启动命令 npm run build </span></span><br><span class="line">      											 <span class="comment">//第一个webpack代表是nodemodules包里面，第二个代表的是自己配置webpack打包参数的文件</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;webpack&quot;</span>: <span class="string">&quot;^4.31.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;webpack-cli&quot;</span>: <span class="string">&quot;^3.3.2&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="本地服务"><a href="#本地服务" class="headerlink" title="本地服务"></a>本地服务</h2><ul>
<li>临时服务器（内置express模块来完成）</li>
<li>简单执行    npx webpack-dev-server（这样做好处就是不会真实打包而是在内存中进行打包）</li>
<li>插件安装：<strong>yarn add webpack-dev-server -D</strong>     [无须引入]</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">webpack文件：</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">devServer</span>:&#123; 				<span class="comment">//开发服务器的配置</span></span><br><span class="line">        <span class="attr">port</span>:<span class="number">3000</span>,              <span class="comment">//端口号</span></span><br><span class="line">        <span class="attr">progress</span>:<span class="literal">true</span>,          <span class="comment">//进度条</span></span><br><span class="line">        <span class="attr">contentBase</span>:<span class="string">&quot;./build&quot;</span>, <span class="comment">//指向打包后那个目录</span></span><br><span class="line">        <span class="attr">open</span>:<span class="literal">true</span>,      		<span class="comment">//自动打开网页</span></span><br><span class="line">        <span class="attr">compress</span>:<span class="literal">true</span>  			<span class="comment">//启用gzp压缩</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line">-----------------------------------------------------------------------</span><br><span class="line">package.<span class="property">json</span>文件：</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;webpack --config webpack.config.js&quot;</span>,</span><br><span class="line">    <span class="string">&quot;dev&quot;</span>:<span class="string">&quot;webpack-dev-server&quot;</span>		<span class="comment">//启动命令变为npm run dev会自动生成网页形式预览</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="将打包后的js文件引入到生成的html文件中将html文件也打包"><a href="#将打包后的js文件引入到生成的html文件中将html文件也打包" class="headerlink" title="将打包后的js文件引入到生成的html文件中将html文件也打包"></a><strong>将打包后的js文件引入到生成的html文件中将html文件也打包</strong></h2><ul>
<li>插件安装：<strong>yarn add html-webpack-plugin -D</strong></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用模板生成HTML自动引入js</span></span><br><span class="line">webpack文件：</span><br><span class="line">注意：需要先引入 <span class="keyword">let</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">output</span>:&#123;</span><br><span class="line">        <span class="attr">filename</span>:<span class="string">&quot;bundle.[hash:8].js&quot;</span>,   </span><br><span class="line">        <span class="comment">//打包后的js的文件名     </span></span><br><span class="line">        <span class="comment">//如果希望每次生成的打包文件不一样也可以加哈希戳 </span></span><br><span class="line">        <span class="comment">//每次修改产生新的文件 可以添加冒号代表只显示几位例如8</span></span><br><span class="line">        <span class="attr">path</span>:path.<span class="title function_">resolve</span>(__dirname,<span class="string">&quot;build&quot;</span>),</span><br><span class="line">        <span class="comment">//路径必须是一个绝对路径 加上dirname代表当前目录下生成一个dist文件夹</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>:[   <span class="comment">//数组 放着所有的webpack插件</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">template</span>:<span class="string">&#x27;./src/index.html&#x27;</span>,    <span class="comment">//找到最后压缩引入的模板</span></span><br><span class="line">            <span class="attr">filename</span>:<span class="string">&quot;index.html&quot;</span>,          <span class="comment">//生成的文件名称</span></span><br><span class="line">            <span class="attr">minify</span>:&#123;</span><br><span class="line">                <span class="attr">removeAttributeQuotes</span>:<span class="literal">true</span>,  <span class="comment">//删除属性的双引号</span></span><br><span class="line">                <span class="attr">collapseWhitespace</span>:<span class="literal">true</span>     <span class="comment">//折叠成为一行</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">hash</span>:<span class="literal">true</span>       <span class="comment">//生成哈希戳</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<blockquote>
<p>插件地址：<a target="_blank" rel="noopener" href="https://github.com/jantimon/html-webpack-plugin#options">html-webpack-plugin#options</a></p>
</blockquote>
<h2 id="样式处理"><a href="#样式处理" class="headerlink" title="样式处理"></a><strong>样式处理</strong></h2><ul>
<li>如果link引入会直接原封不动的将html打包 并不会链接到css</li>
<li>可以用js require方式引入css文件 但打包默认不支持需要合适的loader做解析支持</li>
<li>解析器安装:<ul>
<li><strong>yarn add css-loader style-loader -D</strong></li>
<li><strong>yarn add less less-loader -D</strong></li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">webpack文件：</span><br><span class="line">放在<span class="variable language_">module</span>.<span class="property">exports</span>里面</span><br><span class="line"><span class="attr">module</span>:&#123; <span class="comment">//模块</span></span><br><span class="line">        <span class="attr">rules</span>:[<span class="comment">//规则   </span></span><br><span class="line">            <span class="comment">//css-loader   解析@import这种语法</span></span><br><span class="line">            <span class="comment">//style-loader 它是把css插入到head的标签中</span></span><br><span class="line">            <span class="comment">//loader的特点：希望单一</span></span><br><span class="line">            <span class="comment">//loader的用法 字符串 只使用一个loader</span></span><br><span class="line">            <span class="comment">//多个loader需要[]</span></span><br><span class="line">            <span class="comment">//loader的顺序 默认是从右向左执行  从下到上执行</span></span><br><span class="line">            <span class="comment">//loader还可以写成对象方式</span></span><br><span class="line">            &#123;</span><br><span class="line">         		<span class="comment">//处理css文件</span></span><br><span class="line">                <span class="attr">test</span>:<span class="regexp">/\.css$/</span>,<span class="attr">use</span>:[</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">loader</span>:<span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">                        <span class="attr">options</span>:&#123;</span><br><span class="line">                            <span class="attr">insertAt</span>:<span class="string">&#x27;top&#x27;</span>  <span class="comment">//解析完后的css样式插入到顶部不会与自己写的样式冲突</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">loader</span>:<span class="string">&#x27;css-loader&#x27;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//可以处理less文件  也可以处理sass stylus </span></span><br><span class="line">                <span class="comment">//sass sass-loader </span></span><br><span class="line">                <span class="comment">//stylus stylus-loader</span></span><br><span class="line">                <span class="attr">test</span>:<span class="regexp">/\.less$/</span>,<span class="attr">use</span>:[</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">loader</span>:<span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">                        <span class="attr">options</span>:&#123;</span><br><span class="line">                            <span class="attr">insertAt</span>:<span class="string">&#x27;top&#x27;</span>  <span class="comment">//解析完后的css样式插入到顶部不会与自己写的样式冲突</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    </span><br><span class="line">                        <span class="string">&#x27;css-loader&#x27;</span>,   <span class="comment">// @import 解析路径</span></span><br><span class="line">                        <span class="string">&#x27;less-loader&#x27;</span>   <span class="comment">// 把less -&gt; css </span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="单独抽离css样式插件用link引入"><a href="#单独抽离css样式插件用link引入" class="headerlink" title="单独抽离css样式插件用link引入"></a><strong>单独抽离css样式插件用link引入</strong></h2><ul>
<li>插件安装：<strong>yarn add mini-css-extract-plugin -D</strong></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">webpack文件：</span><br><span class="line"><span class="keyword">let</span> <span class="title class_">MiniCssExtractPlguin</span> = <span class="built_in">require</span>(<span class="string">&#x27;mini-css-extract-plugin&#x27;</span>);  </span><br><span class="line"><span class="comment">//如果需要抽离多个css文件 多引入几次就可以</span></span><br><span class="line"><span class="attr">plugins</span>:[   <span class="comment">//数组 放着所有的webpack插件</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlguin</span>(&#123;</span><br><span class="line">            <span class="attr">filename</span>:<span class="string">&#x27;main.css&#x27;</span>,    <span class="comment">//抽离出的文件名</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line"><span class="attr">module</span>:&#123; <span class="comment">//模块</span></span><br><span class="line">        <span class="attr">rules</span>:[</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>:<span class="regexp">/\.css$/</span>,<span class="attr">use</span>:[</span><br><span class="line">                    <span class="title class_">MiniCssExtractPlguin</span>.<span class="property">loader</span>,<span class="comment">//不需要放在HTML里面 而是单独抽离到main.css文件内</span></span><br><span class="line">                    <span class="string">&#x27;css-loader&#x27;</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>:<span class="regexp">/\.less$/</span>,<span class="attr">use</span>:[</span><br><span class="line">                    <span class="title class_">MiniCssExtractPlguin</span>.<span class="property">loader</span>, <span class="comment">//不需要放在HTML里面 而是单独抽离到main.css文件内</span></span><br><span class="line">                        <span class="string">&#x27;css-loader&#x27;</span>,   <span class="comment">// @import 解析路径</span></span><br><span class="line">                        <span class="string">&#x27;less-loader&#x27;</span>   <span class="comment">// 把less -&gt; css </span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>抽离css插件文件时可使用<code>optimize-css-assets-webpack-plugin</code>优化压缩css以及js文件</p>
</blockquote>
<h2 id="特殊样式自动添加对应浏览器前缀"><a href="#特殊样式自动添加对应浏览器前缀" class="headerlink" title="特殊样式自动添加对应浏览器前缀"></a><strong>特殊样式自动添加对应浏览器前缀</strong></h2><ul>
<li>注意需要单独创建一个<strong>postcss.config.js</strong>文件</li>
<li>注意放置顺序！</li>
<li>插件安装: <strong>yarn add postcss-loader autoprefixer -D</strong></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">webpack文件：</span><br><span class="line"><span class="attr">module</span>:&#123; <span class="comment">//模块</span></span><br><span class="line">        <span class="attr">rules</span>:[</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>:<span class="regexp">/\.css$/</span>,<span class="attr">use</span>:[</span><br><span class="line">                    <span class="title class_">MiniCssExtractPlguin</span>.<span class="property">loader</span>,<span class="comment">//不需要放在HTML里面 而是单独抽离到main.css文件内</span></span><br><span class="line">                    <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;postcss-loader&#x27;</span><span class="comment">//自动添加特殊样式前缀注意要先处理它</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>:<span class="regexp">/\.less$/</span>,<span class="attr">use</span>:[</span><br><span class="line">                    <span class="title class_">MiniCssExtractPlguin</span>.<span class="property">loader</span>, <span class="comment">//不需要放在HTML里面 而是单独抽离到main.css文件内</span></span><br><span class="line">                        <span class="string">&#x27;css-loader&#x27;</span>,   <span class="comment">// @import 解析路径</span></span><br><span class="line">                        <span class="string">&#x27;less-loader&#x27;</span>,   <span class="comment">// 把less -&gt; css </span></span><br><span class="line">                    	<span class="string">&#x27;postcss-loader&#x27;</span> <span class="comment">//自动添加特殊样式前缀注意要先处理它</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">postcss.<span class="property">config</span>.<span class="property">js</span>文件：</span><br><span class="line">只需写如下内容即可：</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">plugins</span>:[<span class="built_in">require</span>(<span class="string">&#x27;autoprefixer&#x27;</span>)]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/postcss/postcss-loader">postcss-loader</a></p>
</blockquote>
<h2 id="打包抽离出之后的css样式"><a href="#打包抽离出之后的css样式" class="headerlink" title="打包抽离出之后的css样式**"></a>打包抽离出之后的css样式**</h2><ul>
<li>插件安装：<ul>
<li><strong>yarn add optimize-css-assets-webpack-plugin -D</strong></li>
<li><strong>yarn add uglifyjs-webpack-plugin -D</strong></li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">webpack文件：</span><br><span class="line"><span class="keyword">let</span> <span class="title class_">OptimizeCss</span> = <span class="built_in">require</span>(<span class="string">&#x27;optimize-css-assets-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="title class_">UglifyJsPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;uglifyjs-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">optimization</span>:&#123;				<span class="comment">//优化项</span></span><br><span class="line">        <span class="attr">minimizer</span>:[</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">UglifyJsPlugin</span>(&#123;</span><br><span class="line">                <span class="attr">cache</span>:<span class="literal">true</span>, 	<span class="comment">//是否用缓存</span></span><br><span class="line">                <span class="attr">parallel</span>:<span class="literal">true</span>,	<span class="comment">//是否并发打包就是压缩多个</span></span><br><span class="line">                <span class="attr">sourceMap</span>:<span class="literal">true</span> 	<span class="comment">//es6转为es5需要源码映射</span></span><br><span class="line">            &#125;),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">OptimizeCss</span>()   <span class="comment">//注意如果使用了这个插件 js不会进行压缩 需另需插件</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用babel来将es6语法转为es5好进行调试"><a href="#使用babel来将es6语法转为es5好进行调试" class="headerlink" title="使用babel来将es6语法转为es5好进行调试"></a><strong>使用babel来将es6语法转为es5好进行调试</strong></h2><ul>
<li>插件安装： <ul>
<li><strong>yarn add babel-loader @babel/core @babel/preset-env -D</strong> //es6</li>
<li><strong>yarn add @babel/plugin-proposal-class-properties -D</strong>     //es7更高级语法转化</li>
<li><strong>yarn add @babel/plugin-proposal-decorators -D</strong>            //类的装饰器</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">webpack文件：</span><br><span class="line"><span class="attr">module</span>:&#123; <span class="comment">//模块</span></span><br><span class="line">        <span class="attr">rules</span>:[</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>:<span class="regexp">/.\js$/</span>,</span><br><span class="line">                <span class="attr">use</span>:&#123;</span><br><span class="line">                    <span class="attr">loader</span>:<span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">                    <span class="attr">options</span>:&#123;<span class="comment">//用babel-loader 需要把es6 -&gt; es5</span></span><br><span class="line">                        <span class="attr">presets</span>:[   <span class="comment">//预设</span></span><br><span class="line">                            <span class="string">&#x27;@babel/preset-env&#x27;</span></span><br><span class="line">                        ],</span><br><span class="line">                        <span class="attr">plugins</span>:[	</span><br><span class="line">                            [<span class="string">&quot;@babel/plugin-proposal-decorators&quot;</span>, &#123; <span class="string">&quot;legacy&quot;</span>: <span class="literal">true</span> &#125;],	<span class="comment">//解析并转化es7中的修饰器 </span></span><br><span class="line">                            [<span class="string">&quot;@babel/plugin-proposal-class-properties&quot;</span>, &#123; <span class="string">&quot;loose&quot;</span> : <span class="literal">true</span> &#125;]	<span class="comment">//解析es6中的类class</span></span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="处理js语法"><a href="#处理js语法" class="headerlink" title="处理js语法"></a><strong>处理js语法</strong></h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">插件安装：yarn add @babel/plugin-transform-runtime -D</span><br><span class="line">		yarn add @babel/runtime 	<span class="comment">//注意此插件在生产中也需要不要加-D</span></span><br><span class="line">		yarn add @babel/polyfill	<span class="comment">//同样也是补丁模块不能加-D</span></span><br><span class="line">webpack文件：</span><br><span class="line"><span class="attr">rules</span>:[</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>:<span class="regexp">/.\js$/</span>,</span><br><span class="line">                <span class="attr">use</span>:&#123;</span><br><span class="line">                    <span class="attr">loader</span>:<span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">                    <span class="attr">options</span>:&#123;<span class="comment">//用babel-loader 需要把es6 -&gt; es5</span></span><br><span class="line">                        <span class="attr">presets</span>:[   <span class="comment">//预设</span></span><br><span class="line">                            <span class="string">&#x27;@babel/preset-env&#x27;</span></span><br><span class="line">                        ],</span><br><span class="line">                        <span class="attr">plugins</span>:[</span><br><span class="line">                            [<span class="string">&quot;@babel/plugin-proposal-decorators&quot;</span>, &#123; <span class="string">&quot;legacy&quot;</span>: <span class="literal">true</span> &#125;],      <span class="comment">//解析es7中的装饰器</span></span><br><span class="line">                            [<span class="string">&quot;@babel/plugin-proposal-class-properties&quot;</span>, &#123; <span class="string">&quot;loose&quot;</span> : <span class="literal">true</span> &#125;], <span class="comment">//解析es6中的类class</span></span><br><span class="line">                            <span class="string">&quot;@babel/plugin-transform-runtime&quot;</span>	<span class="comment">//多次使用只需打包一次</span></span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">include</span>:path.<span class="title function_">resolve</span>(__dirname,<span class="string">&#x27;src&#x27;</span>),  <span class="comment">//只匹配这个目录下的js </span></span><br><span class="line">                <span class="attr">exclude</span>:<span class="regexp">/node_modules/</span>                  <span class="comment">//忽略node包</span></span><br><span class="line">            &#125;,</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line"> a.<span class="property">js</span>文件：<span class="comment">//在任何你需要includes这种高阶语法时引入</span></span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&#x27;@babel/polyfill&#x27;</span>) 	<span class="comment">//需要先进行引入</span></span><br><span class="line">  <span class="string">&#x27;aaa&#x27;</span>.<span class="title function_">includes</span>(<span class="string">&#x27;a&#x27;</span>)			<span class="comment">//然后便可打包使用并且最后转化成es5语法</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="语法检查校验"><a href="#语法检查校验" class="headerlink" title="语法检查校验"></a><strong>语法检查校验</strong></h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">插件安装：yarn add eslint eslint-loader -D</span><br><span class="line"><span class="comment">//首先去eslint官网找到demo 找到实例 并勾选你需要校验的类型 然后下载一个json文件</span></span><br><span class="line"><span class="comment">//下载完成后放到项目根目录中 并且文件前加.</span></span><br><span class="line">webpack文件：</span><br><span class="line"><span class="attr">rules</span>:[ <span class="comment">//loader 默认 是从右向左执行 从下到上执行</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>:<span class="regexp">/\.js$/</span>,</span><br><span class="line">                <span class="attr">use</span>:&#123;</span><br><span class="line">                    <span class="attr">loader</span>:<span class="string">&#x27;eslint-loader&#x27;</span>,</span><br><span class="line">                    <span class="attr">options</span>:&#123;</span><br><span class="line">                        <span class="attr">enforce</span>:<span class="string">&#x27;pre&#x27;</span>   <span class="comment">//previous之前执行  post之后执行 注意要</span></span><br><span class="line">                        <span class="comment">//先执行eslint校验</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="解决全局变量引入问题"><a href="#解决全局变量引入问题" class="headerlink" title="解决全局变量引入问题"></a><strong>解决全局变量引入问题</strong></h2><ul>
<li>引入方式有3种<ul>
<li>expose-loader 暴露到window上</li>
<li>providePlugin 给每个人提供一个$</li>
<li>引入不打包</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">插件安装： yarn add expose-loader <span class="comment">//注意：生产也需要所以不加D</span></span><br><span class="line">index.<span class="property">js</span>文件</span><br><span class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">&#x27;expose-loader?$!jquery&#x27;</span>; <span class="comment">//把jQuery暴露给全局上</span></span><br><span class="line"><span class="comment">//expose-loader 暴露全局的loader 内联的loader </span></span><br><span class="line"><span class="comment">//pre 前面执行的loader normal 普通loader postloader 内联loader 后置loader</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">$</span>)</span><br><span class="line"><span class="comment">//以上属性内联loader写法</span></span><br><span class="line">-----------------------------------------------------------------------------</span><br><span class="line">webpack文件：</span><br><span class="line"><span class="attr">rules</span>:[ </span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>:<span class="built_in">require</span>.<span class="title function_">resolve</span>(<span class="string">&#x27;jquery&#x27;</span>),</span><br><span class="line">                <span class="attr">use</span>:<span class="string">&#x27;expose-loader?$&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">]</span><br><span class="line"><span class="comment">//以上属于普通loader也是将jQuery暴露给全局并以$符表示</span></span><br><span class="line">----------------------------------------------------------------------------</span><br><span class="line">index.<span class="property">js</span>文件：</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>($)<span class="comment">//在每个模块中注入$对象</span></span><br><span class="line">webpack文件：</span><br><span class="line"><span class="keyword">let</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>)</span><br><span class="line"><span class="comment">//这样做好处就是不需要每个js文件都引入 只需在webpack配置文件里引入一次</span></span><br><span class="line"><span class="attr">plugins</span>:[   <span class="comment">//数组 放着所有的webpack插件</span></span><br><span class="line">        <span class="keyword">new</span> webpack.<span class="title class_">ProvidePlugin</span>(&#123; <span class="comment">//在每个模块中都注入$</span></span><br><span class="line">            <span class="attr">$</span>:<span class="string">&#x27;jquery&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line"><span class="comment">//需要注意如果用cdn引入了外部插件 并且 import也 引入了 会有冲突需要配置如下 </span></span><br><span class="line">webpack文件：</span><br><span class="line"><span class="attr">externals</span>:&#123;</span><br><span class="line">        <span class="attr">jquery</span>:<span class="string">&#x27;$&#x27;</span>	<span class="comment">//忽略并且不打包</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="图片处理"><a href="#图片处理" class="headerlink" title="图片处理"></a>图片处理</h2><ul>
<li>JS中创建</li>
<li>CSS中引入</li>
<li><code>&lt;img src=&quot;&quot;&gt;</code></li>
<li><strong>插件安装：yarn add file-loader -D</strong></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack 打包图片</span></span><br><span class="line"><span class="comment">//1）在js中创建图片引入</span></span><br><span class="line"><span class="comment">//file-loader默认会在内部生成一张图片 到build目录下</span></span><br><span class="line"><span class="comment">//把生成图片的名字返回回来</span></span><br><span class="line">index.<span class="property">js</span>文件：</span><br><span class="line"><span class="keyword">import</span> dog <span class="keyword">from</span> <span class="string">&#x27;./dog.jpg&#x27;</span>; <span class="comment">//把图片引入，返回的结果是一个新的图片地址</span></span><br><span class="line"><span class="keyword">let</span> image = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">image.<span class="property">src</span> = dog <span class="comment">//就是一个普通的字符串</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(image)</span><br><span class="line">webpack文件：</span><br><span class="line"> <span class="attr">rules</span>:[</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>:<span class="regexp">/\.(png|jpg|gif)$/</span>,</span><br><span class="line">                <span class="attr">use</span>:<span class="string">&#x27;file-loader&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">]</span><br><span class="line"><span class="comment">//2）在css引入 background（&#x27;url&#x27;）</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index.css&#x27;</span>路径</span><br><span class="line">css文件里<span class="attr">background</span>:<span class="title function_">url</span>(<span class="string">&#x27;路径&#x27;</span>)正常写</span><br><span class="line"><span class="comment">//以上两种使用相同配置即可</span></span><br><span class="line">-----------------------------------------------------------------------------</span><br><span class="line"><span class="comment">//3）&lt;img src=&quot;&quot;&gt;</span></span><br><span class="line">插件安装： yarn add html-withimg-loader -D	<span class="comment">//解析html并且编译图片</span></span><br><span class="line"><span class="attr">rules</span>:[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">test</span>:<span class="regexp">/\.html$/</span>,</span><br><span class="line">        <span class="attr">use</span>:<span class="string">&#x27;html-withimg-loader&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">图片转化成base64插件</span><br><span class="line">插件安装： yarn add url-loader -D</span><br><span class="line"><span class="attr">rules</span>:[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">test</span>:<span class="regexp">/\.(png|jpg|gif)$/</span>,</span><br><span class="line">        <span class="comment">//做一个限制当图片 小于多少k的时候用base64来转化</span></span><br><span class="line">        <span class="comment">//否则便会使用file-loader产生真实的图片</span></span><br><span class="line">        <span class="attr">use</span>:&#123;</span><br><span class="line">            <span class="attr">loader</span>:<span class="string">&#x27;url-loader&#x27;</span>,</span><br><span class="line">            <span class="attr">options</span>:&#123;</span><br><span class="line">                <span class="attr">limit</span>:<span class="number">1</span>     <span class="comment">//判断图片文件大小 超过指定范围默认产出</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="打包产出文件分类"><a href="#打包产出文件分类" class="headerlink" title="打包产出文件分类"></a>打包产出文件分类</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">webpack文件：</span><br><span class="line"><span class="attr">plugins</span>:[   <span class="comment">//数组 放着所有的webpack插件</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlguin</span>(&#123;</span><br><span class="line">            <span class="attr">filename</span>:<span class="string">&#x27;css/main.css&#x27;</span>,    <span class="comment">//抽离出的文件名  添加css/代表目录下的这个文件</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line"><span class="attr">rules</span>:[</span><br><span class="line">    <span class="attr">use</span>:&#123;</span><br><span class="line">    				<span class="attr">test</span>:<span class="regexp">/\.(png|jpg|gif)$/</span>,</span><br><span class="line">                    <span class="attr">loader</span>:<span class="string">&#x27;url-loader&#x27;</span>,</span><br><span class="line">                    <span class="attr">options</span>:&#123;</span><br><span class="line">                        <span class="attr">limit</span>:<span class="number">1</span>,     <span class="comment">//判断图片文件大小 超过指定范围默认产出</span></span><br><span class="line">                        <span class="attr">outputPath</span>:<span class="string">&#x27;/img/&#x27;</span>,	<span class="comment">//最后产出的目录</span></span><br><span class="line">                        <span class="attr">publicPath</span>:<span class="string">&#x27;http://www.miaochen.com&#x27;</span>	<span class="comment">//可以给图片添加地址前缀</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">]</span><br><span class="line">也可以给所有引入文件添加引入前缀：</span><br><span class="line"><span class="attr">output</span>:&#123;</span><br><span class="line">         <span class="attr">filename</span>:<span class="string">&quot;bundle.[hash:8].js&quot;</span>,</span><br><span class="line">         <span class="attr">path</span>:path.<span class="title function_">resolve</span>(__dirname,<span class="string">&quot;build&quot;</span>),</span><br><span class="line">         <span class="attr">publicPath</span>:<span class="string">&#x27;http://www.miaochen.cn/&#x27;</span>	<span class="comment">//给引用文件添加统一前缀</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="多页面应用"><a href="#多页面应用" class="headerlink" title="多页面应用"></a>多页面应用</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">插件安装：yarn add html-webpack-plugin -D</span><br><span class="line"><span class="comment">//用模板生成HTML自动引入js</span></span><br><span class="line">webpack文件：</span><br><span class="line"><span class="comment">//多页面打包</span></span><br><span class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">mode</span>:<span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">    <span class="comment">//多入口</span></span><br><span class="line">    <span class="attr">entry</span>:&#123;</span><br><span class="line">        <span class="attr">home</span>:<span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">        <span class="attr">other</span>:<span class="string">&#x27;./src/other.js&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">output</span>:&#123;</span><br><span class="line">        <span class="attr">filename</span>:<span class="string">&#x27;[name].[hash].js&#x27;</span>,   <span class="comment">//多出口</span></span><br><span class="line">        <span class="attr">path</span>:path.<span class="title function_">resolve</span>(__dirname,<span class="string">&#x27;dist&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>:[</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">template</span>:<span class="string">&#x27;./index.html&#x27;</span>,		<span class="comment">//注意当前模板html文件所在位置</span></span><br><span class="line">            <span class="attr">filename</span>:<span class="string">&#x27;home.html&#x27;</span>,</span><br><span class="line">            <span class="attr">chunks</span>:[<span class="string">&#x27;home&#x27;</span>]     <span class="comment">//选择你需要最后生成HTML文件引入的文件</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">template</span>:<span class="string">&#x27;./index.html&#x27;</span>,		<span class="comment">//注意当前模板html文件所在位置</span></span><br><span class="line">            <span class="attr">filename</span>:<span class="string">&#x27;other.html&#x27;</span>,</span><br><span class="line">            <span class="attr">chunks</span>:[<span class="string">&#x27;other&#x27;</span>,<span class="string">&#x27;home&#x27;</span>]     <span class="comment">//选择你需要最后生成HTML文件引入的文件</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="source-map相关调试设置"><a href="#source-map相关调试设置" class="headerlink" title="source-map相关调试设置"></a>source-map相关调试设置</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="comment">//以下任选一种所需</span></span><br><span class="line">    <span class="comment">//1）源码映射 会单独生成一个sourcemap文件 出错了会标示当前报错的列和行实际会生成源码如果出错会跳转到相对应源码位置 大 和 全</span></span><br><span class="line">    <span class="attr">devtool</span>:<span class="string">&#x27;source-map&#x27;</span>,<span class="comment">//增加映射文件 可以帮我们调试源代码</span></span><br><span class="line">    <span class="comment">//2）不会产生单独的文件 但是可以显示列和行</span></span><br><span class="line">    <span class="attr">devtool</span>:<span class="string">&#x27;eval-source-map&#x27;</span>,</span><br><span class="line">    <span class="comment">//3） 不会产生列 但是是一个单独的映射文件</span></span><br><span class="line">    <span class="attr">devtool</span>:<span class="string">&#x27;cheap-module-source-map&#x27;</span>,  <span class="comment">//产生后你可以保留起来调试</span></span><br><span class="line">    <span class="comment">//4）不会产生产生文件 集成在打包后的文件中 不会产生列</span></span><br><span class="line">    <span class="attr">devtool</span>:<span class="string">&#x27;cheap-module-eval-source-map&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="watch的用法"><a href="#watch的用法" class="headerlink" title="watch的用法"></a>watch的用法</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">webpack文件：</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    	<span class="attr">watch</span>:<span class="literal">true</span>,         <span class="comment">//监控代码变化时时打包</span></span><br><span class="line">        <span class="attr">watchOptions</span>:&#123;      <span class="comment">//监控的选项</span></span><br><span class="line">            <span class="attr">poll</span>:<span class="number">1000</span>,      <span class="comment">//每秒 问我 1000次  多少秒监控一次</span></span><br><span class="line">            <span class="attr">aggregateTimeout</span>:<span class="number">500</span>,   <span class="comment">//防抖 我一直输入代码 停止操作后500毫秒进行打包</span></span><br><span class="line">            <span class="attr">ignored</span>:<span class="regexp">/node_modules/</span> <span class="comment">//不需要进行监控哪个文件</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="webpack3个小插件"><a href="#webpack3个小插件" class="headerlink" title="webpack3个小插件"></a>webpack3个小插件</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">插件①安装：yarn add clean-webpack-plugin -D	<span class="comment">//每次打包清除旧目录内容</span></span><br><span class="line">webpack文件：</span><br><span class="line"><span class="keyword">let</span> cleanWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">plugins</span>:[</span><br><span class="line">        <span class="keyword">new</span> <span class="title function_">cleanWebpackPlugin</span>(&#123;<span class="attr">path</span>:<span class="string">&#x27;./dist&#x27;</span>&#125;)    <span class="comment">//清空目录里原有内容 参数可以是字符串 也可以是数组代表情况多个目录</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">-----------------------------------------------------------------------------</span><br><span class="line">插件②安装：yarn add copy-webpack-plugin -D</span><br><span class="line"><span class="keyword">let</span> copyWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">plugins</span>:[</span><br><span class="line">        <span class="keyword">new</span> <span class="title function_">copyWebpackPlugin</span>([ 	<span class="comment">//拷贝插件  将别的文件 也 拷贝到打包后的文件中</span></span><br><span class="line">            &#123;<span class="attr">from</span>:<span class="string">&#x27;./doc&#x27;</span>,<span class="attr">to</span>:<span class="string">&#x27;./dist&#x27;</span>&#125;  <span class="comment">//拷贝多个就写多个对象</span></span><br><span class="line">        ])</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">插件③：内置插件无须安装</span><br><span class="line"><span class="keyword">let</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">plugins</span>:[</span><br><span class="line">       <span class="keyword">new</span> webpack.<span class="title class_">BannerPlugin</span>(<span class="string">&#x27;miao ni ma&#x27;</span>)	<span class="comment">//用处 会在每一个打包后的js文件 前面加一段 注释</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="webpack-跨域"><a href="#webpack-跨域" class="headerlink" title="webpack 跨域"></a><code>webpack</code> 跨域</h2><p>设置一个服务,由于<code>webpack-dev-server</code>内含<code>express</code></p>
<p><a target="_blank" rel="noopener" href="https://expressjs.com/zh-cn/starter/hello-world.html">express</a></p>
<p><code>server.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// express</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/api/user&#x27;</span>, <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">json</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;miaochen&#x27;</span>&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>)   <span class="comment">// 服务端口在3000</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>写完后记得<code>node server.js</code></p>
<p>访问 <code>http://localhost:3000/api/user</code> 可见内容</p>
<p><code>index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 发送一个请求</span></span><br><span class="line"><span class="keyword">let</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认访问 http://localhost:8080  webpack-dev-server 的服务 -&gt; 再转发给3000</span></span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;/api/user&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">xhr.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr.<span class="property">response</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">xhr.<span class="title function_">send</span>();</span><br></pre></td></tr></table></figure>

<p><code>webpack.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">  <span class="attr">proxy</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;/api&#x27;</span>: <span class="string">&#x27;http://localhost:3000&#x27;</span> <span class="comment">// 配置了一个代理</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="如果后端给的请求没有API-「跨域」"><a href="#如果后端给的请求没有API-「跨域」" class="headerlink" title="如果后端给的请求没有API 「跨域」"></a>如果后端给的请求没有API 「跨域」</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// express</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> app = <span class="title function_">express</span>();</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/user&#x27;</span>, <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">json</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;mayufo&#x27;</span>&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>)   <span class="comment">// 服务端口在3000</span></span><br></pre></td></tr></table></figure>

<p>请求已api开头, 转发的时候再删掉api</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">proxy</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;/api&#x27;</span>: &#123;   <span class="comment">//注意一下 发请求的时候 &#x27;/api/user&#x27;这样的格式 每次要带上</span></span><br><span class="line">            <span class="attr">target</span>: <span class="string">&#x27;http://localhost:3000&#x27;</span>,</span><br><span class="line">            <span class="attr">pathRewrite</span>: &#123;<span class="string">&#x27;^/api&#x27;</span>: <span class="string">&#x27;&#x27;</span>&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="前端mock数据-「跨域」"><a href="#前端mock数据-「跨域」" class="headerlink" title="前端mock数据 「跨域」"></a>前端mock数据 「跨域」</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">before</span>: <span class="keyword">function</span> (<span class="params">app</span>) &#123;  <span class="comment">// 勾子</span></span><br><span class="line">        app.<span class="title function_">get</span>(<span class="string">&#x27;/user&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">            res.<span class="title function_">json</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;miaochen - before&#x27;</span>&#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="有服务端，不用代理-服务端启动webpack-「跨域」"><a href="#有服务端，不用代理-服务端启动webpack-「跨域」" class="headerlink" title="有服务端，不用代理, 服务端启动webpack 「跨域」"></a>有服务端，不用代理, 服务端启动webpack 「跨域」</h2><p><code>server.js</code>中启动<code>webpack</code></p>
<p><code>yarn add webpack-dev-middleware -D</code></p>
<p><code>server.js</code></p>
<p>就相当于后端启动webpack</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// express</span></span><br><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="comment">// 中间件</span></span><br><span class="line"><span class="keyword">let</span> middle = <span class="built_in">require</span>(<span class="string">&#x27;webpack-dev-middleware&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> config = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.config&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> compiler = <span class="title function_">webpack</span>(config)</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">middle</span>(compiler))</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/user&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">json</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;mayufo&#x27;</span>&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>

<h2 id="webpack解析resolve"><a href="#webpack解析resolve" class="headerlink" title="webpack解析resolve"></a>webpack解析resolve</h2><p>以<code>bootstrap</code>为例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install bootstrap  -D</span><br></pre></td></tr></table></figure>

<p><code>index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;bootstrap/dist/css/bootstrap.css&#x27;</span></span><br></pre></td></tr></table></figure>

<p>报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ERROR in ./node_modules/bootstrap/dist/css/bootstrap.css 7:0</span><br><span class="line">Module parse failed: Unexpected token (7:0)</span><br><span class="line">You may need an appropriate loader to handle this file type.</span><br><span class="line">|  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)</span><br><span class="line">|  */</span><br><span class="line">&gt; :root &#123;</span><br><span class="line">|   --blue: #007bff;</span><br><span class="line">|   --indigo: #6610f2;</span><br><span class="line"> @ ./src/index.js 22:0-42</span><br><span class="line"> @ multi (webpack)-dev-server/client?http://localhost:8081 ./src/index.js</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这是因为<code>bootstrap</code> 4.0的css引入了新的特性，CSS Variables</p>
<p>安装<br><code>npm install postcss-custom-properties --save-dev</code></p>
<p>配置<code>webpack.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">    <span class="attr">use</span>: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&#x27;postcss-loader&#x27;</span>,</span><br><span class="line">        <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">plugins</span>: <span class="function">(<span class="params">loader</span>) =&gt;</span> [</span><br><span class="line">                <span class="built_in">require</span>(<span class="string">&quot;postcss-custom-properties&quot;</span>)</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="但是每次引入都很长，如何优雅引入"><a href="#但是每次引入都很长，如何优雅引入" class="headerlink" title="但是每次引入都很长，如何优雅引入"></a>但是每次引入都很长，如何优雅引入</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">resolve</span>: &#123;		<span class="comment">//解析第三方包 common</span></span><br><span class="line">    <span class="comment">// 在当前目录查找</span></span><br><span class="line">    <span class="attr">modules</span>: [path.<span class="title function_">resolve</span>(<span class="string">&#x27;node_modules&#x27;</span>)],</span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;bootstrapCss&#x27;</span>: <span class="string">&#x27;bootstrap/dist/css/bootstrap.css&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;bootstrapCss&#x27;</span>  <span class="comment">// 在node_modules查找</span></span><br></pre></td></tr></table></figure>

<h2 id="省略扩展名"><a href="#省略扩展名" class="headerlink" title="省略扩展名"></a>省略扩展名</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="comment">// 在当前目录查找</span></span><br><span class="line">    <span class="attr">modules</span>: [path.<span class="title function_">resolve</span>(<span class="string">&#x27;node_modules&#x27;</span>)],</span><br><span class="line">    <span class="comment">// alias: &#123;</span></span><br><span class="line">    <span class="comment">//     &#x27;bootstrapCss&#x27;: &#x27;bootstrap/dist/css/bootstrap.css&#x27;</span></span><br><span class="line">    <span class="comment">// &#125;,</span></span><br><span class="line">    <span class="attr">mainFields</span>: [<span class="string">&#x27;style&#x27;</span>, <span class="string">&#x27;main&#x27;</span>],   <span class="comment">// 先用bootstrap中在package中的style,没有在用main</span></span><br><span class="line">    <span class="comment">// mainFiles: []  // 入口文件的名字 默认index</span></span><br><span class="line">    <span class="attr">extensions</span>: [<span class="string">&#x27;.js&#x27;</span>, <span class="string">&#x27;.css&#x27;</span>, <span class="string">&#x27;.json&#x27;</span>]  <span class="comment">// 当没有拓展命的时候，先默认js、次之css、再次之json</span></span><br><span class="line">&#125;,</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="定义环境变量"><a href="#定义环境变量" class="headerlink" title="定义环境变量"></a>定义环境变量</h2><p><code>DefinePlugin</code> 允许创建一个在编译时可以配置的全局常量。这可能会对开发模式和生产模式的构建允许不同的行为非常有用。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> url = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable constant_">DEV</span> === <span class="string">&#x27;dev&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// 开发环境</span></span><br><span class="line">    url = <span class="string">&#x27;http://localhost:3000&#x27;</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 生成环境</span></span><br><span class="line">    url = <span class="string">&#x27;http://www.miaochen.cn&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>webpack.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.<span class="title class_">DefinePlugin</span>(&#123;</span><br><span class="line">    <span class="comment">// DEV: &#x27;&quot;production&quot;&#x27;,</span></span><br><span class="line">    <span class="attr">DEV</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="string">&#x27;production&#x27;</span>),</span><br><span class="line">    <span class="attr">FLAG</span>: <span class="string">&#x27;true&#x27;</span>,   <span class="comment">// 布尔</span></span><br><span class="line">    <span class="attr">EXPRESSION</span>: <span class="string">&#x27;1 + 1&#x27;</span>   <span class="comment">// 字符串 如果希望是字符串 JSON.stringify(&#x27;1 + 1&#x27;)</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>magnet:?xt=urn:btih:8bdbb86adc883dd0bb740a577de3fb1a95ed29c3</p>
<h2 id="区分两个不同的环境"><a href="#区分两个不同的环境" class="headerlink" title="区分两个不同的环境"></a>区分两个不同的环境</h2><p>分别配置不同的环境</p>
<ul>
<li><code>webpack.base4.js</code>   基础配置</li>
<li><code>webpack.dev4.js</code>    开发环境</li>
<li><code>webpack.prod4.js</code>   生产环境</li>
</ul>
<p><code>yarn add webpack-merge -D</code></p>
<p><code>npx run build -- config webpack.dev4.js</code><br><code>npx run build -- config webpack.build.js</code></p>
<p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/guides/production/">官方文档</a></p>
<p><code>webpack.base4.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="title class_">CleanWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">entry</span>: &#123;</span><br><span class="line">        <span class="attr">home</span>: <span class="string">&#x27;./src/index.js&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&quot;[name].js&quot;</span>,</span><br><span class="line">        <span class="attr">path</span>: path.<span class="title function_">resolve</span>(process.<span class="title function_">cwd</span>(), <span class="string">&#x27;dist3&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                <span class="attr">use</span>: &#123;</span><br><span class="line">                    <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">                    <span class="attr">options</span>: &#123;</span><br><span class="line">                        <span class="attr">presets</span>: [</span><br><span class="line">                            <span class="string">&#x27;@babel/preset-env&#x27;</span></span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                <span class="attr">use</span>: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>, &#123;</span><br><span class="line">                    <span class="attr">loader</span>: <span class="string">&#x27;postcss-loader&#x27;</span>,</span><br><span class="line">                    <span class="attr">options</span>: &#123;</span><br><span class="line">                        <span class="attr">plugins</span>: <span class="function">(<span class="params">loader</span>) =&gt;</span> [</span><br><span class="line">                            <span class="built_in">require</span>(<span class="string">&quot;postcss-custom-properties&quot;</span>)</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">template</span>: <span class="string">&#x27;./src/index.html&#x27;</span>,</span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&#x27;index.html&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>webpack.dev4.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> merge = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> base = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.base4.js&#x27;</span>)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">merge</span>(base, &#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">    <span class="attr">devServer</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">devtool</span>: <span class="string">&#x27;source-map&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><code>webpack.prod4.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> merge = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> base = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.base4.js&#x27;</span>)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">merge</span>(base, &#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><code>package.json</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;webpack-dev-server  --config webpack.prod4.js&quot;</span>,</span><br><span class="line">    <span class="string">&quot;dev&quot;</span>: <span class="string">&quot;webpack-dev-server --config webpack.dev4.js&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="webpack-优化"><a href="#webpack-优化" class="headerlink" title="webpack 优化"></a>webpack 优化</h2><p><code>yarn add webpack webpack-cli html-webpack-plugin @babel/core babel-loader @babel/preset-env @babel/preset-react -D</code></p>
<p><code>webpack.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;main.js&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">      <span class="attr">rules</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">              <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">              <span class="attr">use</span>: &#123;</span><br><span class="line">                  <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">                  <span class="attr">options</span>: &#123;</span><br><span class="line">                      <span class="attr">presets</span>: [</span><br><span class="line">                          <span class="string">&#x27;@babel/preset-env&#x27;</span>,		<span class="comment">//解析es6</span></span><br><span class="line">                          <span class="string">&#x27;@babel/preset-react&#x27;</span>		<span class="comment">//解析react</span></span><br><span class="line">                      ]</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">template</span>: <span class="string">&#x27;./src/index.html&#x27;</span>,</span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&#x27;index.html&#x27;</span></span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="优化：当某些包是独立的个体没有依赖"><a href="#优化：当某些包是独立的个体没有依赖" class="headerlink" title="优化：当某些包是独立的个体没有依赖"></a>优化：当某些包是独立的个体没有依赖</h2><p>以jquery为例，<code>yarn add jquery -D</code>,它是一个独立的包没有依赖，可以在webpack配置中，配置它不再查找依赖</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">noParse</span>: <span class="regexp">/jquery/</span>, <span class="comment">// 不用解析某些包的依赖</span></span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">          <span class="attr">use</span>: &#123;</span><br><span class="line">              <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">              <span class="attr">options</span>: &#123;</span><br><span class="line">                  <span class="attr">presets</span>: [</span><br><span class="line">                      <span class="string">&#x27;@babel/preset-env&#x27;</span>,</span><br><span class="line">                      <span class="string">&#x27;@babel/preset-react&#x27;</span></span><br><span class="line">                  ]</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">  ]</span><br><span class="line">&#125;,</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行<code>npx webpack</code></p>
<p>从2057ms  -&gt; 1946 ms</p>
<h2 id="优化：规则匹配设置范围"><a href="#优化：规则匹配设置范围" class="headerlink" title="优化：规则匹配设置范围"></a>优化：规则匹配设置范围</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules</span>: [</span><br><span class="line">  &#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      <span class="attr">exclude</span>: <span class="string">&#x27;/node_modules/&#x27;</span>,   <span class="comment">// 排除</span></span><br><span class="line">      <span class="attr">include</span>: path.<span class="title function_">resolve</span>(<span class="string">&#x27;src&#x27;</span>),  <span class="comment">// 在这个范围内</span></span><br><span class="line">      <span class="attr">use</span>: &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">              <span class="attr">presets</span>: [</span><br><span class="line">                  <span class="string">&#x27;@babel/preset-env&#x27;</span>,</span><br><span class="line">                  <span class="string">&#x27;@babel/preset-react&#x27;</span></span><br><span class="line">              ]</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>尽量实用<code>include</code>,不使用<code>exclude</code>,使用绝对路径</p>
<h2 id="优化：忽略依赖中不必要的语言包"><a href="#优化：忽略依赖中不必要的语言包" class="headerlink" title="优化：忽略依赖中不必要的语言包"></a>优化：忽略依赖中不必要的语言包</h2><p><code>yarn add moment webpack-dev-server -D</code></p>
<p>忽略掉<code>moment</code>的其他语言包</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> webpack.<span class="title class_">IgnorePlugin</span>(<span class="regexp">/\.\/locale/</span>, <span class="regexp">/moment/</span>)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><code>index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">&#x27;moment&#x27;</span></span><br><span class="line"><span class="comment">//设置语言</span></span><br><span class="line"><span class="comment">//手动引入所需要的语言</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;moment/locale/zh-cn&#x27;</span></span><br><span class="line">moment.<span class="title function_">locale</span>(<span class="string">&#x27;zh-cn&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> r = <span class="title function_">moment</span>().<span class="title function_">endOf</span>(<span class="string">&#x27;day&#x27;</span>).<span class="title function_">fromNow</span>()  <span class="comment">// 距离现在多少天</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(r);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>从 1.2MB 到  800kb</p>
<h2 id="动态链接库"><a href="#动态链接库" class="headerlink" title="动态链接库"></a>动态链接库</h2><p><code>yarn add react react-dom</code></p>
<p>正常使用</p>
<p><code>webpack.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">  <span class="attr">exclude</span>: <span class="string">&#x27;/node_modules/&#x27;</span>,</span><br><span class="line">  <span class="attr">include</span>: path.<span class="title function_">resolve</span>(<span class="string">&#x27;src&#x27;</span>),</span><br><span class="line">  <span class="attr">use</span>: &#123;</span><br><span class="line">      <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">          <span class="attr">presets</span>: [</span><br><span class="line">              <span class="string">&#x27;@babel/preset-env&#x27;</span>,</span><br><span class="line">              <span class="string">&#x27;@babel/preset-react&#x27;</span></span><br><span class="line">          ]</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;render&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>111111<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>, <span class="variable language_">window</span>.<span class="property">root</span>)</span><br></pre></td></tr></table></figure>

<p><code>index.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>独立的将<code>react react-dom</code> 打包好, 打包好再引用，从而减少<code>webpack</code>每次都要打包<code>react</code></p>
<p>创建<code>webpack.config.react.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">    <span class="attr">entry</span>: &#123;</span><br><span class="line">        <span class="comment">// test: &#x27;./src/test.js&#x27;</span></span><br><span class="line">        <span class="attr">react</span>: [<span class="string">&#x27;react&#x27;</span>, <span class="string">&#x27;react-dom&#x27;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;_dll_[name].js&#x27;</span>,  <span class="comment">// 产生的文件名</span></span><br><span class="line">        <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">        <span class="attr">library</span>: <span class="string">&#x27;_dll_[name]&#x27;</span>,     <span class="comment">// 给输出的结果加个名字</span></span><br><span class="line">        <span class="comment">// libraryTarget: &#x27;var&#x27;   // 配置如何暴露 library</span></span><br><span class="line">        <span class="comment">// commonjs 结果放在export属性上， umd统一资源模块, 默认是var</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">       <span class="keyword">new</span> webpack.<span class="title class_">DllPlugin</span>(&#123;</span><br><span class="line">           <span class="attr">name</span>: <span class="string">&#x27;_dll_[name]&#x27;</span>,   <span class="comment">// name === library</span></span><br><span class="line">           <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>, <span class="string">&#x27;manifest.json&#x27;</span>)  <span class="comment">// manifest.json 定义了各个模块的路径</span></span><br><span class="line">       &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/configuration/output/#%E6%9A%B4%E9%9C%B2%E4%B8%BA%E4%B8%80%E4%B8%AA%E5%8F%98%E9%87%8F">libraryTarget</a></p>
<p><code>manifest.json</code>就是一个任务清单or动态链接库，在这个清单里面查找react</p>
<p><code>npx webpack --config webpack.config.react.js</code></p>
<p>在<code>index.html</code>增加引用</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/_dll_react.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在webpack.config.js 中配置，现在动态链接库<code>manifest.json</code>中查找,如果没有再打包react</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> webpack.<span class="title class_">DllReferencePlugin</span>(&#123;</span><br><span class="line">        <span class="attr">manifest</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>, <span class="string">&#x27;manifest.json&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/plugins/dll-plugin/#src/components/Sidebar/Sidebar.jsx">DLLPlugin 和 DLLReferencePlugin</a></p>
<p><code>npm run build</code></p>
<p>打包后的<code>bunle.js</code>文件变小</p>
<p><code>npm run dev</code></p>
<p>可以理解为先把react打包，后面每次都直接使用react打包后的结果</p>
<h2 id="多线程打包happypack"><a href="#多线程打包happypack" class="headerlink" title="多线程打包happypack"></a>多线程打包<code>happypack</code></h2><p><code>yarn add happypack</code></p>
<p><code>webpack.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title class_">Happypack</span> = <span class="built_in">require</span>(<span class="string">&#x27;happypack&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="attr">rules</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="string">&#x27;/node_modules/&#x27;</span>,</span><br><span class="line">        <span class="attr">include</span>: path.<span class="title function_">resolve</span>(<span class="string">&#x27;src&#x27;</span>),</span><br><span class="line">        <span class="attr">use</span>: <span class="string">&#x27;happypack/loader?id=js&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Happypack</span>(&#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="string">&#x27;js&#x27;</span>,</span><br><span class="line">        <span class="attr">use</span>: [&#123;</span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">                <span class="attr">presets</span>: [</span><br><span class="line">                    <span class="string">&#x27;@babel/preset-env&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;@babel/preset-react&#x27;</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>js启用多线程，由于启用多线程也会浪费时间，因此当项目比较大的时候启用效果更好</p>
<p>css启用多线程</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">    <span class="attr">use</span>: <span class="string">&#x27;happypack/loader?id=css&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">new</span> <span class="title class_">Happypack</span>(&#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&#x27;css&#x27;</span>,</span><br><span class="line">    <span class="attr">use</span>: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="webpack-自带的优化"><a href="#webpack-自带的优化" class="headerlink" title="webpack 自带的优化"></a>webpack 自带的优化</h2><p><code>test.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title function_">sum</span> = (<span class="params">a, b</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b + <span class="string">&#x27;sum&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">minus</span> = (<span class="params">a, b</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> a - b + <span class="string">&#x27;minus&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"> sum, minus</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>使用import </li>
</ol>
<p><code>index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> calc <span class="keyword">from</span> <span class="string">&#x27;./test&#x27;</span></span><br><span class="line"><span class="comment">//import在生产环境下会自动去除没有用的代码`minus`，这叫`tree-shaking`，将没有用的代码自动删除掉</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(calc.<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>));</span><br></pre></td></tr></table></figure>

<p><code>index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> calc = <span class="built_in">require</span>(<span class="string">&#x27;./test&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(calc);   <span class="comment">// es 6导出，是一个default的对象</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(calc.<span class="property">default</span>.<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>));</span><br></pre></td></tr></table></figure>

<p>require引入es6 模块会把结果放在default上,打包build后并不会把多余<code>minus</code>代码删除掉，不支持<code>tree-shaking</code></p>
<ol start="2">
<li>作用域的提升（scope hosting）</li>
</ol>
<p><code>index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="number">2</span></span><br><span class="line"><span class="keyword">let</span> c = <span class="number">3</span></span><br><span class="line"><span class="keyword">let</span> d = a + b + c</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(d, <span class="string">&#x27;---------&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>打包出来的文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(r.<span class="property">default</span>.<span class="title function_">sum</span>(<span class="number">1</span>,<span class="number">2</span>));<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">6</span>,<span class="string">&quot;---------&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>在webpack中可以省略一些可以简化的代码</p>
<h2 id="抽取公共代码"><a href="#抽取公共代码" class="headerlink" title="抽取公共代码"></a>抽取公共代码</h2><ol>
<li>抽离自有模块</li>
</ol>
<p><code>webpack.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">splitChunks</span>: &#123;  <span class="comment">// 分割代码块，针对多入口</span></span><br><span class="line">        <span class="attr">cacheGroups</span>: &#123;   <span class="comment">// 缓存组</span></span><br><span class="line">            <span class="attr">common</span>: &#123;   <span class="comment">// 公共模块</span></span><br><span class="line">                <span class="attr">minSize</span>: <span class="number">0</span>,  <span class="comment">// 大于多少抽离</span></span><br><span class="line">                <span class="attr">minChunks</span>: <span class="number">2</span>,  <span class="comment">// 使用多少次以上抽离抽离</span></span><br><span class="line">                <span class="attr">chunks</span>: <span class="string">&#x27;initial&#x27;</span>  <span class="comment">// 从什么地方开始,刚开始</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/plugins/split-chunks-plugin/">SplitChunksPlugin</a></p>
<p>分别有a.js和b.js, index.js和other.js分别引入a和b两个js</p>
<p><code>index.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import &#x27;./a&#x27;</span><br><span class="line">import &#x27;./b&#x27;</span><br><span class="line">console.log(&#x27;index.js&#x27;);</span><br></pre></td></tr></table></figure>

<p><code>other.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import &#x27;./a&#x27;</span><br><span class="line">import &#x27;./b&#x27;</span><br><span class="line">console.log(&#x27;other.js&#x27;);</span><br></pre></td></tr></table></figure>

<p><code>webpack.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">splitChunks</span>: &#123;  <span class="comment">// 分割代码块，针对多入口</span></span><br><span class="line">        <span class="attr">cacheGroups</span>: &#123;   <span class="comment">// 缓存组</span></span><br><span class="line">            <span class="attr">common</span>: &#123;   <span class="comment">// 公共模块</span></span><br><span class="line">                <span class="attr">minSize</span>: <span class="number">0</span>,  <span class="comment">// 大于多少抽离</span></span><br><span class="line">                <span class="attr">minChunks</span>: <span class="number">2</span>,  <span class="comment">// 使用多少次以上抽离抽离</span></span><br><span class="line">                <span class="attr">chunks</span>: <span class="string">&#x27;initial&#x27;</span>  <span class="comment">// 从什么地方开始,刚开始</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>抽离第三方模块</li>
</ol>
<p>比如jquery</p>
<p><code>index.js</code> 和 <code>other.js</code>分别引入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import $ from &#x27;jquery&#x27;</span><br><span class="line"></span><br><span class="line">console.log($);</span><br></pre></td></tr></table></figure>

<p><code>webpack.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">splitChunks</span>: &#123;  <span class="comment">// 分割代码块，针对多入口</span></span><br><span class="line">        <span class="attr">cacheGroups</span>: &#123;   <span class="comment">// 缓存组</span></span><br><span class="line">            <span class="attr">common</span>: &#123;   <span class="comment">// 公共模块</span></span><br><span class="line">                <span class="attr">minSize</span>: <span class="number">0</span>,  <span class="comment">// 大于多少抽离</span></span><br><span class="line">                <span class="attr">minChunks</span>: <span class="number">2</span>,  <span class="comment">// 使用多少次以上抽离抽离</span></span><br><span class="line">                <span class="attr">chunks</span>: <span class="string">&#x27;initial&#x27;</span>  <span class="comment">// 从什么地方开始,刚开始</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">vendor</span>: &#123;</span><br><span class="line">                <span class="attr">priority</span>: <span class="number">1</span>, <span class="comment">// 增加权重,先抽离第三方</span></span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/node_modules/</span>, <span class="comment">//只抽离当前目录下</span></span><br><span class="line">                <span class="attr">minSize</span>: <span class="number">0</span>,  <span class="comment">// 大于多少抽离</span></span><br><span class="line">                <span class="attr">minChunks</span>: <span class="number">2</span>,  <span class="comment">// 使用多少次以上抽离抽离</span></span><br><span class="line">                <span class="attr">chunks</span>: <span class="string">&#x27;initial&#x27;</span>  <span class="comment">// 从什么地方开始,刚开始</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="懒加载-延迟加载"><a href="#懒加载-延迟加载" class="headerlink" title="懒加载(延迟加载)"></a>懒加载(延迟加载)</h2><p><code>yarn add @babel/plugin-syntax-dynamic-import  -D</code>    语法动态导入插件</p>
<p><code>source.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="string">&#x27;miaochen&#x27;</span></span><br></pre></td></tr></table></figure>

<p><code>index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> button = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;button&#x27;</span>)</span><br><span class="line">button.<span class="property">innerHTML</span> = <span class="string">&#x27;may&#x27;</span></span><br><span class="line"><span class="comment">//vue的懒加载 react懒加载</span></span><br><span class="line">button.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;click&#x27;</span>)</span><br><span class="line">    <span class="comment">// es6草案中的语法，jsonp实现动态加载文件</span></span><br><span class="line">    <span class="title function_">import</span>(<span class="string">&#x27;./source.js&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data.<span class="property">default</span>);  <span class="comment">//miaochen</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(button)</span><br></pre></td></tr></table></figure>

<p><code>webpack.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">    <span class="attr">exclude</span>: <span class="string">&#x27;/node_modules/&#x27;</span>,</span><br><span class="line">    <span class="attr">include</span>: path.<span class="title function_">resolve</span>(<span class="string">&#x27;src&#x27;</span>),</span><br><span class="line">    <span class="attr">use</span>: [&#123;</span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">        <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">presets</span>: [  <span class="comment">//预设</span></span><br><span class="line">                <span class="string">&#x27;@babel/preset-env&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;@babel/preset-react&#x27;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">plugins</span>: [</span><br><span class="line">                <span class="string">&#x27;@babel/plugin-syntax-dynamic-import&#x27;</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="热更新-当页面改变只更新改变的部分，不重新打包"><a href="#热更新-当页面改变只更新改变的部分，不重新打包" class="headerlink" title="热更新(当页面改变只更新改变的部分，不重新打包)"></a>热更新(当页面改变只更新改变的部分，不重新打包)</h2><p><code>webpack.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">devServer</span>:&#123;</span><br><span class="line">    <span class="attr">hot</span>:<span class="literal">true</span>   <span class="comment">//启用热更新</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">template</span>: <span class="string">&#x27;./src/index.html&#x27;</span>,</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;index.html&#x27;</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> webpack.<span class="title class_">NameModulesPlugin</span>(), <span class="comment">// 打印更新的模块路径</span></span><br><span class="line">    <span class="keyword">new</span> webpack.<span class="title class_">HotModuleReplacementPlugin</span>()  <span class="comment">//热更新插件</span></span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> str <span class="keyword">from</span> <span class="string">&#x27;./source&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">module</span>.<span class="property">hot</span>) &#123;</span><br><span class="line">    <span class="variable language_">module</span>.<span class="property">hot</span>.<span class="title function_">accept</span>(<span class="string">&#x27;./source&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;文件更新了&#x27;</span>);</span><br><span class="line">        <span class="built_in">require</span>(<span class="string">&#x27;./source&#x27;</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(str);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="tapable介绍-SyncHook"><a href="#tapable介绍-SyncHook" class="headerlink" title="tapable介绍 - SyncHook"></a>tapable介绍 - SyncHook</h2><p><a target="_blank" rel="noopener" href="https://juejin.im/post/5abf33f16fb9a028e46ec352">tapable</a></p>
<p><code>webpack</code>本质上是一种事件流的机制，它的工作流程就是将各个插件串联起来，而实现这一切的核心就是<code>Tapable</code>，<code>webpack</code>中最核心的负责编译的<code>Compiler</code>和负责创建<code>bundles</code>的<code>Compilation</code>都是<code>Tapable</code>的实例。</p>
<p><code>SyncHook</code> 不关心监听函数的返回值</p>
<p><code>yarn add tabable</code></p>
<p><code>1.use.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123;<span class="title class_">SyncHook</span>&#125; = <span class="built_in">require</span>(<span class="string">&#x27;tapable&#x27;</span>)   <span class="comment">// 结构同步勾子</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Lesson</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span> () &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hooks</span> = &#123;</span><br><span class="line">            <span class="comment">// 订阅勾子</span></span><br><span class="line">            <span class="attr">arch</span>: <span class="keyword">new</span> <span class="title class_">SyncHook</span>([<span class="string">&#x27;name&#x27;</span>]),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    start () &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">arch</span>.<span class="title function_">call</span>(<span class="string">&#x27;miao&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    tap () &#123;   <span class="comment">//  注册监听函数</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">arch</span>.<span class="title function_">tap</span>(<span class="string">&#x27;node&#x27;</span>, <span class="keyword">function</span> (<span class="params">name</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;node&#x27;</span>, name)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">arch</span>.<span class="title function_">tap</span>(<span class="string">&#x27;react&#x27;</span>, <span class="keyword">function</span> (<span class="params">name</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;react&#x27;</span>, name)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> l = <span class="keyword">new</span> <span class="title class_">Lesson</span>()</span><br><span class="line"></span><br><span class="line">l.<span class="title function_">tap</span>();  <span class="comment">//注册这两个事件</span></span><br><span class="line">l.<span class="title function_">start</span>() <span class="comment">// 启动勾子</span></span><br></pre></td></tr></table></figure>

<p><code>1.theory.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SyncHook</span> &#123;  <span class="comment">// 钩子是同步的</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">args</span>) &#123;  <span class="comment">// args =&gt; [&#x27;name&#x27;]</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">tasks</span> = []</span><br><span class="line">    &#125;</span><br><span class="line">    tap (name, task) &#123;  <span class="comment">//同步注册</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">tasks</span>.<span class="title function_">push</span>(task)</span><br><span class="line">    &#125;</span><br><span class="line">    call (...args) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">tasks</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">task</span>) =&gt;</span> <span class="title function_">task</span>(...args))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> hook = <span class="keyword">new</span> <span class="title class_">SyncHook</span>([<span class="string">&#x27;name&#x27;</span>])</span><br><span class="line"></span><br><span class="line">hook.<span class="title function_">tap</span>(<span class="string">&#x27;react&#x27;</span>, <span class="keyword">function</span> (<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;react&#x27;</span>, name);</span><br><span class="line">&#125;)</span><br><span class="line">hook.<span class="title function_">tap</span>(<span class="string">&#x27;node&#x27;</span>, <span class="keyword">function</span> (<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;node&#x27;</span>, name);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hook.<span class="title function_">call</span>(<span class="string">&#x27;jw&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="tapable介绍-SyncBailHook"><a href="#tapable介绍-SyncBailHook" class="headerlink" title="tapable介绍 - SyncBailHook"></a>tapable介绍 - SyncBailHook</h2><p><code>SyncBailHook</code>为勾子加了个保险，当<code>return</code>返回不是<code>undefine</code>就会停止</p>
<p><code>2.use.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123;<span class="title class_">SyncBailHook</span>&#125; = <span class="built_in">require</span>(<span class="string">&#x27;tapable&#x27;</span>)   <span class="comment">// 解构同步勾子</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Lesson</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span> () &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hooks</span> = &#123;</span><br><span class="line">            <span class="comment">// 订阅勾子</span></span><br><span class="line">            <span class="attr">arch</span>: <span class="keyword">new</span> <span class="title class_">SyncBailHook</span>([<span class="string">&#x27;name&#x27;</span>]),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    start () &#123;</span><br><span class="line">        <span class="comment">// 发布</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">arch</span>.<span class="title function_">call</span>(<span class="string">&#x27;may&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    tap () &#123;   <span class="comment">//  注册监听函数,订阅</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">arch</span>.<span class="title function_">tap</span>(<span class="string">&#x27;node&#x27;</span>, <span class="keyword">function</span> (<span class="params">name</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;node&#x27;</span>, name)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;停止学习&#x27;</span>  <span class="comment">// 会停止</span></span><br><span class="line">            <span class="comment">// return undefined</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">arch</span>.<span class="title function_">tap</span>(<span class="string">&#x27;react&#x27;</span>, <span class="keyword">function</span> (<span class="params">name</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;react&#x27;</span>, name)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> l = <span class="keyword">new</span> <span class="title class_">Lesson</span>()</span><br><span class="line"></span><br><span class="line">l.<span class="title function_">tap</span>();  <span class="comment">//注册两个函数</span></span><br><span class="line">l.<span class="title function_">start</span>() <span class="comment">// 启动勾子</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>2.theory.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SyncBailHook</span> &#123;  <span class="comment">// 钩子是同步的</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">args</span>) &#123;  <span class="comment">// args =&gt; [&#x27;name&#x27;]</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">tasks</span> = []</span><br><span class="line">    &#125;</span><br><span class="line">    tap (name, task) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">tasks</span>.<span class="title function_">push</span>(task)</span><br><span class="line">    &#125;</span><br><span class="line">    call (...args) &#123;</span><br><span class="line">        <span class="keyword">let</span> ret;   <span class="comment">// 当前函数的返回值</span></span><br><span class="line">        <span class="keyword">let</span> index = <span class="number">0</span>; <span class="comment">// 当前要执行的第一个</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            ret = <span class="variable language_">this</span>.<span class="property">tasks</span>[index++](...args)</span><br><span class="line">        &#125; <span class="keyword">while</span> (ret === <span class="literal">undefined</span>  &amp;&amp; index &lt; <span class="variable language_">this</span>.<span class="property">tasks</span>.<span class="property">length</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> hook = <span class="keyword">new</span> <span class="title class_">SyncBailHook</span>([<span class="string">&#x27;name&#x27;</span>])</span><br><span class="line"></span><br><span class="line">hook.<span class="title function_">tap</span>(<span class="string">&#x27;react&#x27;</span>, <span class="keyword">function</span> (<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;react&#x27;</span>, name);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;停止向下执行&#x27;</span></span><br><span class="line">    <span class="comment">// return undefined</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">hook.<span class="title function_">tap</span>(<span class="string">&#x27;node&#x27;</span>, <span class="keyword">function</span> (<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;node&#x27;</span>, name);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">hook.<span class="title function_">call</span>(<span class="string">&#x27;jw&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="tapable介绍-SyncWaterfallHook"><a href="#tapable介绍-SyncWaterfallHook" class="headerlink" title="tapable介绍 - SyncWaterfallHook"></a>tapable介绍 - SyncWaterfallHook</h2><p><code>SyncWaterfallHook</code>上一个监听函数的返回值可以传给下一个监听函数</p>
<p><code>3.use.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123;<span class="title class_">SyncWaterfallHook</span>&#125; = <span class="built_in">require</span>(<span class="string">&#x27;tapable&#x27;</span>)   <span class="comment">// 解构同步勾子</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// waterfall 瀑布</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Lesson</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span> () &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hooks</span> = &#123;</span><br><span class="line">            <span class="comment">// 订阅勾子</span></span><br><span class="line">            <span class="attr">arch</span>: <span class="keyword">new</span> <span class="title class_">SyncWaterfallHook</span>([<span class="string">&#x27;name&#x27;</span>]),</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    start () &#123;</span><br><span class="line">        <span class="comment">// 发布</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">arch</span>.<span class="title function_">call</span>(<span class="string">&#x27;may&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    tap () &#123;   <span class="comment">//  注册监听函数,订阅</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">arch</span>.<span class="title function_">tap</span>(<span class="string">&#x27;node&#x27;</span>, <span class="keyword">function</span> (<span class="params">name</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;node&#x27;</span>, name)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;学的不错&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">arch</span>.<span class="title function_">tap</span>(<span class="string">&#x27;react&#x27;</span>, <span class="keyword">function</span> (<span class="params">name</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;react&#x27;</span>, name)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> l = <span class="keyword">new</span> <span class="title class_">Lesson</span>()</span><br><span class="line"></span><br><span class="line">l.<span class="title function_">tap</span>();  <span class="comment">//注册两个函数</span></span><br><span class="line">l.<span class="title function_">start</span>() <span class="comment">// 启动勾子</span></span><br></pre></td></tr></table></figure>

<p><code>3.theory.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SyncWaterfallHook</span> &#123;  <span class="comment">// 勾子是同步的 - 瀑布</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">args</span>) &#123;  <span class="comment">// args =&gt; [&#x27;name&#x27;]</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">tasks</span> = []</span><br><span class="line">    &#125;</span><br><span class="line">    tap (name, task) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">tasks</span>.<span class="title function_">push</span>(task)</span><br><span class="line">    &#125;</span><br><span class="line">    call (...args) &#123;</span><br><span class="line">        <span class="keyword">let</span> [first, ...others] = <span class="variable language_">this</span>.<span class="property">tasks</span>;</span><br><span class="line">        <span class="keyword">let</span> ret = <span class="title function_">first</span>(...args)</span><br><span class="line">        others.<span class="title function_">reduce</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">b</span>(a);</span><br><span class="line">        &#125;, ret);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> hook = <span class="keyword">new</span> <span class="title class_">SyncWaterfallHook</span>([<span class="string">&#x27;name&#x27;</span>])</span><br><span class="line"></span><br><span class="line">hook.<span class="title function_">tap</span>(<span class="string">&#x27;react&#x27;</span>, <span class="keyword">function</span> (<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;react&#x27;</span>, name);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;react Ok&#x27;</span></span><br><span class="line">    <span class="comment">// return undefined</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">hook.<span class="title function_">tap</span>(<span class="string">&#x27;node&#x27;</span>, <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;node&#x27;</span>, name);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;node Ok&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">hook.<span class="title function_">tap</span>(<span class="string">&#x27;webpack&#x27;</span>, <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;webpack&#x27;</span>, data);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">hook.<span class="title function_">call</span>(<span class="string">&#x27;jw&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="tapable介绍-SyncLoopHook"><a href="#tapable介绍-SyncLoopHook" class="headerlink" title="tapable介绍 - SyncLoopHook"></a>tapable介绍 - SyncLoopHook</h2><p><code>SyncLoopHook</code>当监听函数被触发的时候，如果该监听函数返回<code>true</code>时则这个监听函数会反复执行，如果返回 <code>undefined</code> 则表示退出循环</p>
<p><code>4.use.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123;<span class="title class_">SyncLoopHook</span>&#125; = <span class="built_in">require</span>(<span class="string">&#x27;tapable&#x27;</span>)   <span class="comment">// 解构同步勾子</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 同步遇到某个不返回undefined的监听函数会多次执行</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Lesson</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span> () &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">index</span> = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hooks</span> = &#123;</span><br><span class="line">            <span class="comment">// 订阅勾子</span></span><br><span class="line">            <span class="attr">arch</span>: <span class="keyword">new</span> <span class="title class_">SyncLoopHook</span>([<span class="string">&#x27;name&#x27;</span>]),</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    start () &#123;</span><br><span class="line">        <span class="comment">// 发布</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">arch</span>.<span class="title function_">call</span>(<span class="string">&#x27;may&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    tap () &#123;   <span class="comment">//  注册监听函数,订阅</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">arch</span>.<span class="title function_">tap</span>(<span class="string">&#x27;node&#x27;</span>,  <span class="function">(<span class="params">name</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;node&#x27;</span>, name)</span><br><span class="line">            <span class="keyword">return</span> ++<span class="variable language_">this</span>.<span class="property">index</span> === <span class="number">3</span> ? <span class="literal">undefined</span> : <span class="string">&#x27;继续学&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">arch</span>.<span class="title function_">tap</span>(<span class="string">&#x27;react&#x27;</span>,  <span class="function">(<span class="params">name</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;react&#x27;</span>, name)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> l = <span class="keyword">new</span> <span class="title class_">Lesson</span>()</span><br><span class="line"></span><br><span class="line">l.<span class="title function_">tap</span>();  <span class="comment">//注册两个函数</span></span><br><span class="line">l.<span class="title function_">start</span>() <span class="comment">// 启动勾子</span></span><br></pre></td></tr></table></figure>

<p><code>4.theory.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SyncLoopHook</span> &#123;  <span class="comment">// 勾子是同步的 - 瀑布</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">args</span>) &#123;  <span class="comment">// args =&gt; [&#x27;name&#x27;]</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">tasks</span> = []</span><br><span class="line">    &#125;</span><br><span class="line">    tap (name, task) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">tasks</span>.<span class="title function_">push</span>(task)</span><br><span class="line">    &#125;</span><br><span class="line">    call (...args) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">tasks</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">task</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> ret</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                ret = <span class="title function_">task</span>(...args);</span><br><span class="line">            &#125; <span class="keyword">while</span>(ret !== <span class="literal">undefined</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> hook = <span class="keyword">new</span> <span class="title class_">SyncLoopHook</span>([<span class="string">&#x27;name&#x27;</span>])</span><br><span class="line"><span class="keyword">let</span> total = <span class="number">0</span></span><br><span class="line">hook.<span class="title function_">tap</span>(<span class="string">&#x27;react&#x27;</span>, <span class="keyword">function</span> (<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;react&#x27;</span>, name);</span><br><span class="line">    <span class="keyword">return</span> ++total === <span class="number">3</span> ? <span class="attr">undefined</span>: <span class="string">&#x27;继续学&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hook.<span class="title function_">tap</span>(<span class="string">&#x27;node&#x27;</span>, <span class="keyword">function</span> (<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;node&#x27;</span>, name);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">hook.<span class="title function_">tap</span>(<span class="string">&#x27;webpack&#x27;</span>, <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;webpack&#x27;</span>, data);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hook.<span class="title function_">call</span>(<span class="string">&#x27;jw&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="AsyncParallelHook-与-AsyncParallelBailHook"><a href="#AsyncParallelHook-与-AsyncParallelBailHook" class="headerlink" title="AsyncParallelHook 与 AsyncParallelBailHook"></a><code>AsyncParallelHook</code> 与 <code>AsyncParallelBailHook</code></h2><p>异步的勾子分两种<code>串行</code>和<code>并行</code></p>
<p><code>并行</code>等待所有并发的异步事件执行后执行回调</p>
<p>注册的三种方法</p>
<ol>
<li>异步的注册方法<code>tap</code></li>
<li>异步的注册方法<code>tapAsync</code>， 还有个回调参数</li>
<li><code>topPromise</code>,注册<code>promise</code></li>
</ol>
<p>调用的三种</p>
<ol>
<li>call (同步)</li>
<li>callAsync （异步）</li>
<li>promise （异步）</li>
</ol>
<p>这里介绍的是异步并行的</p>
<h4 id="AsyncParallelHook"><a href="#AsyncParallelHook" class="headerlink" title="AsyncParallelHook"></a>AsyncParallelHook</h4><p>不关心监听函数的返回值。</p>
<p><code>5.use.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">let &#123;AsyncParallelHook&#125; = require(&#x27;tapable&#x27;)   // 解构同步勾子</span><br><span class="line"></span><br><span class="line">// 不返回undefined 会多次执行</span><br><span class="line"></span><br><span class="line">class Lesson &#123;</span><br><span class="line">    constructor() &#123;</span><br><span class="line">        this.index = 0</span><br><span class="line">        this.hooks = &#123;</span><br><span class="line">            // 订阅勾子</span><br><span class="line">            arch: new AsyncParallelHook([&#x27;name&#x27;]),</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    start() &#123;</span><br><span class="line">        // 发布callAsync</span><br><span class="line">        // this.hooks.arch.callAsync(&#x27;may&#x27;, function () &#123;</span><br><span class="line">        //     console.log(&#x27;end&#x27;);</span><br><span class="line">        // &#125;)</span><br><span class="line">        // 另一种发布promise</span><br><span class="line">        this.hooks.arch.promise(&#x27;may&#x27;).then(function () &#123;</span><br><span class="line">                console.log(&#x27;end&#x27;);</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    tap() &#123;   //  注册监听函数,订阅</span><br><span class="line">        // 注册tapAsync</span><br><span class="line">        // this.hooks.arch.tapAsync(&#x27;node&#x27;,  (name, callback) =&gt; &#123;</span><br><span class="line">        //     setTimeout(() =&gt; &#123;</span><br><span class="line">        //         console.log(&#x27;node&#x27;, name)</span><br><span class="line">        //         callback()</span><br><span class="line">        //     &#125;, 1000)</span><br><span class="line">        // &#125;)</span><br><span class="line">        // this.hooks.arch.tapAsync(&#x27;react&#x27;,  (name, callback) =&gt; &#123;</span><br><span class="line">        //     setTimeout(() =&gt; &#123;</span><br><span class="line">        //         console.log(&#x27;react&#x27;, name)</span><br><span class="line">        //         callback()</span><br><span class="line">        //     &#125;, 1000)</span><br><span class="line">        // &#125;)</span><br><span class="line">        // 另一种订阅 tapPromise</span><br><span class="line">        this.hooks.arch.tapPromise(&#x27;node&#x27;, (name) =&gt; &#123;</span><br><span class="line">            return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">                setTimeout(() =&gt; &#123;</span><br><span class="line">                    console.log(&#x27;node&#x27;, name)</span><br><span class="line">                    resolve()</span><br><span class="line">                &#125;, 1000)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">        this.hooks.arch.tapPromise(&#x27;react&#x27;, (name) =&gt; &#123;</span><br><span class="line">            return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">                setTimeout(() =&gt; &#123;</span><br><span class="line">                    console.log(&#x27;react&#x27;, name)</span><br><span class="line">                    resolve()</span><br><span class="line">                &#125;, 1000)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">let l = new Lesson()</span><br><span class="line"></span><br><span class="line">l.tap();  //注册两个函数</span><br><span class="line">l.start() // 启动勾子</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>5.theory.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">class AsyncParallelHook &#123;  // 勾子是同步的 - 瀑布</span><br><span class="line">    constructor(args) &#123;  // args =&gt; [&#x27;name&#x27;]</span><br><span class="line">        this.tasks = []</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    tapAsync(name, task) &#123;</span><br><span class="line">        this.tasks.push(task)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    tapPromise(name, task) &#123;</span><br><span class="line">        this.tasks.push(task)</span><br><span class="line">    &#125;</span><br><span class="line">    callAsync(...args) &#123;</span><br><span class="line">        let finalCallback = args.pop()   // 拿出最终的函数</span><br><span class="line">        let index = 0</span><br><span class="line">        let done = () =&gt; &#123;   // 类似promise.all的实现</span><br><span class="line">            index++;</span><br><span class="line">            if (index === this.tasks.length) &#123;</span><br><span class="line">                finalCallback();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        this.tasks.forEach(task =&gt; &#123;</span><br><span class="line">            task(...args, done) // 这里的args 已经把最后一个参数删掉</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    promise(...args) &#123;</span><br><span class="line">        let tasks = this.tasks.map(task =&gt; task(...args))</span><br><span class="line">        return Promise.all(tasks)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let hook = new AsyncParallelHook([&#x27;name&#x27;])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// hook.tapAsync(&#x27;react&#x27;, function (name, callback) &#123;</span><br><span class="line">//     setTimeout(() =&gt; &#123;</span><br><span class="line">//         console.log(&#x27;react&#x27;, name);</span><br><span class="line">//         callback()</span><br><span class="line">//     &#125;, 1000)</span><br><span class="line">// &#125;)</span><br><span class="line">//</span><br><span class="line">// hook.tapAsync(&#x27;node&#x27;, function (name, callback) &#123;</span><br><span class="line">//     setTimeout(() =&gt; &#123;</span><br><span class="line">//         console.log(&#x27;node&#x27;, name);</span><br><span class="line">//         callback()</span><br><span class="line">//     &#125;, 1000)</span><br><span class="line">// &#125;)</span><br><span class="line"></span><br><span class="line">// hook.tapAsync(&#x27;webpack&#x27;, function (name, callback) &#123;</span><br><span class="line">//     setTimeout(() =&gt; &#123;</span><br><span class="line">//         console.log(&#x27;webpack&#x27;, name);</span><br><span class="line">//         callback()</span><br><span class="line">//     &#125;, 1000)</span><br><span class="line">// &#125;)</span><br><span class="line"></span><br><span class="line">hook.tapPromise(&#x27;react&#x27;, function (name, callback) &#123;</span><br><span class="line">    return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            console.log(&#x27;react&#x27;, name);</span><br><span class="line">            resolve()</span><br><span class="line">        &#125;, 1000)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">hook.tapPromise(&#x27;node&#x27;, function (name, callback) &#123;</span><br><span class="line">    return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            console.log(&#x27;node&#x27;, name);</span><br><span class="line">            resolve()</span><br><span class="line">        &#125;, 1000)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//</span><br><span class="line">// hook.callAsync(&#x27;jw&#x27;, function () &#123;</span><br><span class="line">//     console.log(&#x27;end&#x27;);</span><br><span class="line">// &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hook.promise(&#x27;jw&#x27;).then(function () &#123;</span><br><span class="line">    console.log(&#x27;end&#x27;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="AsyncParallelBailHook"><a href="#AsyncParallelBailHook" class="headerlink" title="AsyncParallelBailHook"></a>AsyncParallelBailHook</h4><p>只要监听函数的返回值不为 <code>null</code>，就会忽略后面的监听函数执行，直接跳跃到<code>callAsync</code>等触发函数绑定的回调函数，然后执行这个被绑定的回调函数。</p>
<p>使用和原理与<code>SyncBailHook</code>相似</p>
<h2 id="异步串行-——-AsyncSeriesHook"><a href="#异步串行-——-AsyncSeriesHook" class="headerlink" title="异步串行 —— AsyncSeriesHook"></a>异步串行 —— AsyncSeriesHook</h2><p><code>串行 </code>one by one</p>
<p><code>6.use.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">let &#123;AsyncSeriesHook&#125; = require(&#x27;tapable&#x27;)   // 解构同步勾子</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Lesson &#123;</span><br><span class="line">    constructor() &#123;</span><br><span class="line">        this.index = 0</span><br><span class="line">        this.hooks = &#123;</span><br><span class="line">            // 订阅勾子</span><br><span class="line">            arch: new AsyncSeriesHook([&#x27;name&#x27;]),</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    start() &#123;</span><br><span class="line">        // 发布</span><br><span class="line">        // this.hooks.arch.callAsync(&#x27;may&#x27;, function () &#123;</span><br><span class="line">        //     console.log(&#x27;end&#x27;);</span><br><span class="line">        // &#125;)</span><br><span class="line">        // 另一种发布</span><br><span class="line">        this.hooks.arch.promise(&#x27;may&#x27;).then(function () &#123;</span><br><span class="line">                console.log(&#x27;end&#x27;);</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    tap() &#123;   //  注册监听函数,订阅</span><br><span class="line">        // this.hooks.arch.tapAsync(&#x27;node&#x27;,  (name, callback) =&gt; &#123;</span><br><span class="line">        //     setTimeout(() =&gt; &#123;</span><br><span class="line">        //         console.log(&#x27;node&#x27;, name)</span><br><span class="line">        //         callback()</span><br><span class="line">        //     &#125;, 1000)</span><br><span class="line">        // &#125;)</span><br><span class="line">        // this.hooks.arch.tapAsync(&#x27;react&#x27;,  (name, callback) =&gt; &#123;</span><br><span class="line">        //     setTimeout(() =&gt; &#123;</span><br><span class="line">        //         console.log(&#x27;react&#x27;, name)</span><br><span class="line">        //         callback()</span><br><span class="line">        //     &#125;, 1000)</span><br><span class="line">        // &#125;)</span><br><span class="line">        // 另一种订阅</span><br><span class="line">        this.hooks.arch.tapPromise(&#x27;node&#x27;, (name) =&gt; &#123;</span><br><span class="line">            return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">                setTimeout(() =&gt; &#123;</span><br><span class="line">                    console.log(&#x27;node&#x27;, name)</span><br><span class="line">                    resolve()</span><br><span class="line">                &#125;, 1000)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">        this.hooks.arch.tapPromise(&#x27;react&#x27;, (name) =&gt; &#123;</span><br><span class="line">            return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">                setTimeout(() =&gt; &#123;</span><br><span class="line">                    console.log(&#x27;react&#x27;, name)</span><br><span class="line">                    resolve()</span><br><span class="line">                &#125;, 1000)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">let l = new Lesson()</span><br><span class="line"></span><br><span class="line">l.tap();  //注册两个函数</span><br><span class="line">l.start(); // 启动勾子</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>6.theory.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">class AsyncSeriesHook &#123;  //</span><br><span class="line">    constructor(args) &#123;  // args =&gt; [&#x27;name&#x27;]</span><br><span class="line">        this.tasks = []</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    tapAsync(name, task) &#123;</span><br><span class="line">        this.tasks.push(task)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    tapPromise(name, task) &#123;</span><br><span class="line">        this.tasks.push(task)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    callAsync(...args) &#123;</span><br><span class="line">        let finalCallback = args.pop()</span><br><span class="line">        let index = 0;</span><br><span class="line">        let next = () =&gt; &#123;</span><br><span class="line">            if (this.tasks.length === index) return finalCallback();</span><br><span class="line">            let task = this.tasks[index++];</span><br><span class="line">            task(...args, next);</span><br><span class="line">        &#125;</span><br><span class="line">        next();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    promise(...args) &#123;</span><br><span class="line">        // 将promise串联起来</span><br><span class="line">        let [first, ...other] = this.tasks</span><br><span class="line">        return other.reduce((p, n) =&gt; &#123;</span><br><span class="line">             return p.then(() =&gt; n (...args))</span><br><span class="line">        &#125;, first(...args))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let hook = new AsyncSeriesHook([&#x27;name&#x27;])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// hook.tapAsync(&#x27;react&#x27;, function (name, callback) &#123;</span><br><span class="line">//     setTimeout(() =&gt; &#123;</span><br><span class="line">//         console.log(&#x27;react&#x27;, name);</span><br><span class="line">//         callback()</span><br><span class="line">//     &#125;, 1000)</span><br><span class="line">// &#125;)</span><br><span class="line">//</span><br><span class="line">// hook.tapAsync(&#x27;node&#x27;, function (name, callback) &#123;</span><br><span class="line">//     setTimeout(() =&gt; &#123;</span><br><span class="line">//         console.log(&#x27;node&#x27;, name);</span><br><span class="line">//         callback()</span><br><span class="line">//     &#125;, 1000)</span><br><span class="line">// &#125;)</span><br><span class="line">//</span><br><span class="line">// hook.tapAsync(&#x27;webpack&#x27;, function (name, callback) &#123;</span><br><span class="line">//     setTimeout(() =&gt; &#123;</span><br><span class="line">//         console.log(&#x27;webpack&#x27;, name);</span><br><span class="line">//         callback()</span><br><span class="line">//     &#125;, 1000)</span><br><span class="line">// &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hook.tapPromise(&#x27;react&#x27;, function (name, callback) &#123;</span><br><span class="line">    return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            console.log(&#x27;react&#x27;, name);</span><br><span class="line">            resolve()</span><br><span class="line">        &#125;, 1000)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">hook.tapPromise(&#x27;node&#x27;, function (name, callback) &#123;</span><br><span class="line">    return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            console.log(&#x27;node&#x27;, name);</span><br><span class="line">            resolve()</span><br><span class="line">        &#125;, 1000)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// hook.callAsync(&#x27;jw&#x27;, function () &#123;</span><br><span class="line">//     console.log(&#x27;end&#x27;);</span><br><span class="line">// &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hook.promise(&#x27;jw&#x27;).then(function () &#123;</span><br><span class="line">    console.log(&#x27;end&#x27;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="异步串行-——-AsyncSeriesWaterfallHook"><a href="#异步串行-——-AsyncSeriesWaterfallHook" class="headerlink" title="异步串行 —— AsyncSeriesWaterfallHook"></a>异步串行 —— AsyncSeriesWaterfallHook</h2><p>上一个监听函数的中的<code>callback(err, data)</code>的第二个参数,可以作为下一个监听函数的参数</p>
<p><code>7.use.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">let &#123;AsyncSeriesWaterfallHook&#125; = require(&#x27;tapable&#x27;)   // 解构同步勾子</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Lesson &#123;</span><br><span class="line">    constructor() &#123;</span><br><span class="line">        this.index = 0</span><br><span class="line">        this.hooks = &#123;</span><br><span class="line">            // 订阅勾子</span><br><span class="line">            arch: new AsyncSeriesWaterfallHook([&#x27;name&#x27;]),</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    start() &#123;</span><br><span class="line">        // 发布</span><br><span class="line">        this.hooks.arch.callAsync(&#x27;may&#x27;, function () &#123;</span><br><span class="line">            console.log(&#x27;end&#x27;);</span><br><span class="line">        &#125;)</span><br><span class="line">        // 另一种发布</span><br><span class="line">        // this.hooks.arch.promise(&#x27;may&#x27;).then(function () &#123;</span><br><span class="line">        //         console.log(&#x27;end&#x27;);</span><br><span class="line">        //     &#125;</span><br><span class="line">        // )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    tap() &#123;   //  注册监听函数,订阅</span><br><span class="line">        this.hooks.arch.tapAsync(&#x27;node&#x27;,  (name, callback) =&gt; &#123;</span><br><span class="line">            setTimeout(() =&gt; &#123;</span><br><span class="line">                console.log(&#x27;node&#x27;, name)</span><br><span class="line">                // callback(null, &#x27;result&#x27;)</span><br><span class="line">                callback(&#x27;error&#x27;, &#x27;result&#x27;)   // 如果放error, 会跳过直接后面的勾子，直接走到最终的</span><br><span class="line"></span><br><span class="line">            &#125;, 1000)</span><br><span class="line">        &#125;)</span><br><span class="line">        this.hooks.arch.tapAsync(&#x27;react&#x27;,  (name, callback) =&gt; &#123;</span><br><span class="line">            setTimeout(() =&gt; &#123;</span><br><span class="line">                console.log(&#x27;react&#x27;, name)</span><br><span class="line">                callback()</span><br><span class="line">            &#125;, 1000)</span><br><span class="line">        &#125;)</span><br><span class="line">        // 另一种订阅</span><br><span class="line">        // this.hooks.arch.tapPromise(&#x27;node&#x27;, (name) =&gt; &#123;</span><br><span class="line">        //     return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">        //         setTimeout(() =&gt; &#123;</span><br><span class="line">        //             console.log(&#x27;node&#x27;, name)</span><br><span class="line">        //             resolve()</span><br><span class="line">        //         &#125;, 1000)</span><br><span class="line">        //     &#125;)</span><br><span class="line">        // &#125;)</span><br><span class="line">        // this.hooks.arch.tapPromise(&#x27;react&#x27;, (name) =&gt; &#123;</span><br><span class="line">        //     return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">        //         setTimeout(() =&gt; &#123;</span><br><span class="line">        //             console.log(&#x27;react&#x27;, name)</span><br><span class="line">        //             resolve()</span><br><span class="line">        //         &#125;, 1000)</span><br><span class="line">        //     &#125;)</span><br><span class="line">        // &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">let l = new Lesson()</span><br><span class="line"></span><br><span class="line">l.tap();  //注册两个函数</span><br><span class="line">l.start(); // 启动勾子</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>7.theory.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">class AsyncSeriesWaterfallHook &#123;  //</span><br><span class="line">    constructor(args) &#123;  // args =&gt; [&#x27;name&#x27;]</span><br><span class="line">        this.tasks = []</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    tapAsync(name, task) &#123;</span><br><span class="line">        this.tasks.push(task)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    tapPromise(name, task) &#123;</span><br><span class="line">        this.tasks.push(task)</span><br><span class="line">    &#125;</span><br><span class="line">    callAsync(...args) &#123;</span><br><span class="line">        let finalCallback = args.pop()</span><br><span class="line">        let index = 0;</span><br><span class="line">        let next = (err, data) =&gt; &#123;</span><br><span class="line">            let task = this.tasks[index]</span><br><span class="line">            if(!task) return finalCallback();</span><br><span class="line">            if (index === 0) &#123;</span><br><span class="line">                // 执行的第一个</span><br><span class="line">                task(...args, next)</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                task(data, next)</span><br><span class="line">            &#125;</span><br><span class="line">            index ++</span><br><span class="line">        &#125;</span><br><span class="line">        next();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    promise(...args) &#123;</span><br><span class="line">        // 将promise串联起来</span><br><span class="line">        let [first, ...other] = this.tasks</span><br><span class="line">        return other.reduce((p, n) =&gt; &#123;</span><br><span class="line">             return p.then((data) =&gt; n(data))</span><br><span class="line">        &#125;, first(...args))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let hook = new AsyncSeriesWaterfallHook([&#x27;name&#x27;])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// hook.tapAsync(&#x27;react&#x27;, function (name, callback) &#123;</span><br><span class="line">//     setTimeout(() =&gt; &#123;</span><br><span class="line">//         console.log(&#x27;react&#x27;, name);</span><br><span class="line">//         callback(null, &#x27;结果1&#x27;)</span><br><span class="line">//     &#125;, 1000)</span><br><span class="line">// &#125;)</span><br><span class="line">//</span><br><span class="line">// hook.tapAsync(&#x27;node&#x27;, function (name, callback) &#123;</span><br><span class="line">//     setTimeout(() =&gt; &#123;</span><br><span class="line">//         console.log(&#x27;node&#x27;, name);</span><br><span class="line">//         callback(null, &#x27;结果2&#x27;)</span><br><span class="line">//     &#125;, 1000)</span><br><span class="line">// &#125;)</span><br><span class="line">//</span><br><span class="line">// hook.tapAsync(&#x27;webpack&#x27;, function (name, callback) &#123;</span><br><span class="line">//     setTimeout(() =&gt; &#123;</span><br><span class="line">//         console.log(&#x27;webpack&#x27;, name);</span><br><span class="line">//         callback()</span><br><span class="line">//     &#125;, 1000)</span><br><span class="line">// &#125;)</span><br><span class="line"></span><br><span class="line">//</span><br><span class="line">hook.tapPromise(&#x27;react&#x27;, function (name, callback) &#123;</span><br><span class="line">    return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            console.log(&#x27;react&#x27;, name);</span><br><span class="line">            resolve(&#x27;result&#x27;)</span><br><span class="line">        &#125;, 1000)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">hook.tapPromise(&#x27;node&#x27;, function (name, callback) &#123;</span><br><span class="line">    return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            console.log(&#x27;node&#x27;, name);</span><br><span class="line">            resolve()</span><br><span class="line">        &#125;, 1000)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//</span><br><span class="line">//</span><br><span class="line">// hook.callAsync(&#x27;jw&#x27;, function () &#123;</span><br><span class="line">//     console.log(&#x27;end&#x27;);</span><br><span class="line">// &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hook.promise(&#x27;jw&#x27;).then(function () &#123;</span><br><span class="line">    console.log(&#x27;end&#x27;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="手写webpack"><a href="#手写webpack" class="headerlink" title="手写webpack"></a>手写webpack</h2><p><a target="_blank" rel="noopener" href="https://github.com/mayufo/webpack-training">对应的may-pack项目</a></p>
<p><code>yarn add webpack webpack-cli -D</code></p>
<p><code>webpack.config.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">let path = require(&#x27;path&#x27;)</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    mode: &#x27;development&#x27;,</span><br><span class="line">    entry: &#x27;./src/index.js&#x27;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: &#x27;bundle.js&#x27;,</span><br><span class="line">        path: path.resolve(__dirname, &#x27;dist&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>npx webpack</code></p>
<p>生成文件<code>bundle.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">(function (modules) &#123;</span><br><span class="line">    var installedModules = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    function __webpack_require__(moduleId) &#123;</span><br><span class="line"></span><br><span class="line">        if (installedModules[moduleId]) &#123;</span><br><span class="line">            return installedModules[moduleId].exports;</span><br><span class="line">        &#125;</span><br><span class="line">        var module = installedModules[moduleId] = &#123;</span><br><span class="line">            i: moduleId,</span><br><span class="line">            l: false,</span><br><span class="line">            exports: &#123;&#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);</span><br><span class="line"></span><br><span class="line">        module.l = true;</span><br><span class="line"></span><br><span class="line">        return module.exports;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    // Load entry module and return exports</span><br><span class="line">    return __webpack_require__(__webpack_require__.s = &quot;./src/index.js&quot;);</span><br><span class="line">&#125;)</span><br><span class="line">(&#123;</span><br><span class="line">    &quot;./src/a.js&quot;:</span><br><span class="line">        (function (module, exports, __webpack_require__) &#123;</span><br><span class="line">            eval(&quot;let b = __webpack_require__(/*! ./base/b */ \&quot;./src/base/b.js\&quot;)\n\nmodule.exports = &#x27;a&#x27;+ b\n\n\n\n//# sourceURL=webpack:///./src/a.js?&quot;);</span><br><span class="line">        &#125;),</span><br><span class="line">    &quot;./src/base/b.js&quot;:</span><br><span class="line">        (function (module, exports) &#123;</span><br><span class="line">            eval(&quot;module.exports = &#x27;b&#x27;\n\n\n//# sourceURL=webpack:///./src/base/b.js?&quot;);</span><br><span class="line">        &#125;),</span><br><span class="line">    &quot;./src/index.js&quot;:</span><br><span class="line">        (function (module, exports, __webpack_require__) &#123;</span><br><span class="line">            eval(&quot; let str = __webpack_require__(/*! ./a.js */ \&quot;./src/a.js\&quot;)\n\n console.log(str);\n\n\n//# sourceURL=webpack:///./src/index.js?&quot;);</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>新建项目用于自己的<code>webpack</code>,这里叫<code>may-pack</code></p>
<p><code>yarn init</code></p>
<p>如果在node里想执行命令，创建<code>bin</code>文件,再创建<code>may-pack.js</code></p>
<p>配置<code>package.json</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;may-pack&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class="line">  &quot;main&quot;: &quot;index.js&quot;,</span><br><span class="line">  &quot;license&quot;: &quot;MIT&quot;,</span><br><span class="line">  &quot;bin&quot;: &#123;</span><br><span class="line">    &quot;may-pack&quot;: &quot;./bin/may-pack.js&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>may-pack.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#!  /usr/bin/env node </span><br><span class="line"></span><br><span class="line">// node环境</span><br><span class="line"></span><br><span class="line">console.log(&#x27;start&#x27;);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行<code>npm link</code>将npm 模块链接到对应的运行项目中去，方便地对模块进行调试和测试</p>
<p>在想运行<code>may-pack</code>的项目中运行，<code>npm link may-pack</code> 得到 <code>start</code></p>
<h2 id="webpack分析及处理"><a href="#webpack分析及处理" class="headerlink" title="webpack分析及处理"></a>webpack分析及处理</h2><p><code>may-pack.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#!  /usr/bin/env node</span><br><span class="line"></span><br><span class="line">// node环境</span><br><span class="line"></span><br><span class="line">console.log(&#x27;start&#x27;);</span><br><span class="line"></span><br><span class="line">let path = require(&#x27;path&#x27;)</span><br><span class="line"></span><br><span class="line">// 拿到配置文件webpack.config.js</span><br><span class="line">let config = require(path.resolve(&#x27;webpack.config.js&#x27;));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">let Compiler = require(&#x27;../lib/Compiler.js&#x27;);</span><br><span class="line"></span><br><span class="line">let compiler = new Compiler(config);</span><br><span class="line"></span><br><span class="line">// 标识运行编译</span><br><span class="line">compiler.run()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>创建<code>lib</code>文件<code>Compiler.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">let path = require(&#x27;path&#x27;)</span><br><span class="line">let fs = require(&#x27;fs&#x27;)</span><br><span class="line"></span><br><span class="line">class Compiler &#123;</span><br><span class="line">    constructor(config) &#123;</span><br><span class="line">        // entry  output</span><br><span class="line">        this.config = config</span><br><span class="line">        // 需要保存入口文件的路径</span><br><span class="line">        this.entryId = &#x27;&#x27;;   // &#x27;./src/index.js&#x27;</span><br><span class="line">        // 需要保存所有的模块依赖</span><br><span class="line">        this.modules = &#123;&#125;;</span><br><span class="line">        this.entry = config.entry  // 入口文件</span><br><span class="line">        // 工作目录</span><br><span class="line">        this.root = process.cwd(); // 当前运行npx的路径</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 构建模块</span><br><span class="line">    buildModule(modulePath, isEntry) &#123;</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 发射文件</span><br><span class="line">    emitFile() &#123;</span><br><span class="line">        // 用数据 渲染想要的</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    run() &#123;</span><br><span class="line">        // 执行 创建模块的依赖关系</span><br><span class="line">        this.buildModule(path.resolve(this.root, this.entry), true)  // path.resolve(this.root, this.entry) 得到入口文件的绝对路径</span><br><span class="line">        // 发射打包后的文件</span><br><span class="line">        this.emitFile()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = Compiler</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>主要两个任务</p>
<ol>
<li>拿到入口Id</li>
<li>解析模块，也就是实现<code>buildModule</code>方法</li>
</ol>
<h2 id="创建依赖关系"><a href="#创建依赖关系" class="headerlink" title="创建依赖关系"></a>创建依赖关系</h2><p><code>may-pack</code>中<code>Compiler.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">let path = require(&#x27;path&#x27;)</span><br><span class="line">let fs = require(&#x27;fs&#x27;)</span><br><span class="line">// babylon  主要把源码转成ast Babylon 是 Babel 中使用的 JavaScript 解析器。</span><br><span class="line">// @babel/traverse 对ast解析遍历语法树 负责替换，删除和添加节点</span><br><span class="line">// @babel/types 用于AST节点的Lodash-esque实用程序库</span><br><span class="line">// @babel/generator 结果生成</span><br><span class="line"></span><br><span class="line">let babylon = require(&#x27;babylon&#x27;)</span><br><span class="line">let traverse = require(&#x27;@babel/traverse&#x27;).default;</span><br><span class="line">let type = require(&#x27;@babel/types&#x27;);</span><br><span class="line">let generator = require(&#x27;@babel/generator&#x27;).default</span><br><span class="line">class Compiler &#123;</span><br><span class="line">    constructor(config) &#123;</span><br><span class="line">        // entry  output</span><br><span class="line">        this.config = config</span><br><span class="line">        // 需要保存入口文件的路径</span><br><span class="line">        this.entryId = &#x27;&#x27;;   // &#x27;./src/index.js&#x27;</span><br><span class="line">        // 需要保存所有的模块依赖</span><br><span class="line">        this.modules = &#123;&#125;;</span><br><span class="line">        this.entry = config.entry  // 入口文件</span><br><span class="line">        // 工作目录</span><br><span class="line">        this.root = process.cwd(); // 当前运行npx的路径</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    // 拿到模块内容</span><br><span class="line">    getSource (modulePath) &#123;</span><br><span class="line">        let content = fs.readFileSync(modulePath, &#x27;utf8&#x27;)</span><br><span class="line">        return content</span><br><span class="line">    &#125;</span><br><span class="line">    parse (source, parentPath) &#123;</span><br><span class="line">        console.log(source, parentPath)</span><br><span class="line">    &#125;</span><br><span class="line">    // 构建模块</span><br><span class="line">    buildModule(modulePath, isEntry) &#123;</span><br><span class="line">        // 拿到模块内容</span><br><span class="line">        let source = this.getSource(modulePath)  // 得到入口文件的内容</span><br><span class="line">        // 模块id modulePath(需要相对路径) = modulePath(模块路径) - this.root(项目工作路径)   src/index.js</span><br><span class="line">        let moduleName = &#x27;./&#x27; + path.relative(this.root, modulePath)</span><br><span class="line">        console.log(source, moduleName);  // 拿到代码 和相对路径 ./src/index.js</span><br><span class="line">        if (isEntry) &#123;</span><br><span class="line">            this.entryId = moduleName</span><br><span class="line">        &#125;</span><br><span class="line">        let &#123;sourceCode, dependencies&#125; = this.parse(source, path.dirname(moduleName))   // ./src</span><br><span class="line">        // 把相对路径和模块中的内容对应起来</span><br><span class="line">        this.modules[moduleName] = sourceCode</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 发射文件</span><br><span class="line">    emitFile() &#123;</span><br><span class="line">        // 用数据 渲染想要的</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    run() &#123;</span><br><span class="line">        // 执行 创建模块的依赖关系</span><br><span class="line">        this.buildModule(path.resolve(this.root, this.entry), true)  // path.resolve(this.root, this.entry) 得到入口文件的绝对路径</span><br><span class="line">        console.log(this.modules, this.entryId);</span><br><span class="line">        // 发射打包后的文件</span><br><span class="line">        this.emitFile()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = Compiler</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="ast递归解析"><a href="#ast递归解析" class="headerlink" title="ast递归解析"></a>ast递归解析</h2><p><code>parse</code>方法主要靠解析语法树来进行转义<br><code>babylon</code>  主要把源码转成ast Babylon 是 Babel 中使用的 JavaScript 解析器。<br><code>@babel/traverse</code> 对ast解析遍历语法树 负责替换，删除和添加节点<br><code>@babel/types</code> 用于AST节点的Lodash-esque实用程序库<br><code>@babel/generator</code> 结果生成</p>
<p><code>yarn add babylon @babel/traverse @babel/types @babel/generator</code></p>
<p><code>may-pack</code>中<code>Compiler.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">let path = require(&#x27;path&#x27;)</span><br><span class="line">let fs = require(&#x27;fs&#x27;)</span><br><span class="line">// babylon  主要把源码转成ast Babylon 是 Babel 中使用的 JavaScript 解析器。</span><br><span class="line">// @babel/traverse 对ast解析遍历语法树 负责替换，删除和添加节点</span><br><span class="line">// @babel/types 用于AST节点的Lodash-esque实用程序库</span><br><span class="line">// @babel/generator 结果生成</span><br><span class="line"></span><br><span class="line">let babylon = require(&#x27;babylon&#x27;)</span><br><span class="line">let traverse = require(&#x27;@babel/traverse&#x27;).default;</span><br><span class="line">let type = require(&#x27;@babel/types&#x27;);</span><br><span class="line">let generator = require(&#x27;@babel/generator&#x27;).default</span><br><span class="line">class Compiler &#123;</span><br><span class="line">    constructor(config) &#123;</span><br><span class="line">        // entry  output</span><br><span class="line">        this.config = config</span><br><span class="line">        // 需要保存入口文件的路径</span><br><span class="line">        this.entryId = &#x27;&#x27;;   // &#x27;./src/index.js&#x27;</span><br><span class="line">        // 需要保存所有的模块依赖</span><br><span class="line">        this.modules = &#123;&#125;;</span><br><span class="line">        this.entry = config.entry  // 入口文件</span><br><span class="line">        // 工作目录</span><br><span class="line">        this.root = process.cwd(); // 当前运行npx的路径</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    // 拿到模块内容</span><br><span class="line">    getSource (modulePath) &#123;</span><br><span class="line">        let content = fs.readFileSync(modulePath, &#x27;utf8&#x27;)</span><br><span class="line">        return content</span><br><span class="line">    &#125;</span><br><span class="line">    parse (source, parentPath) &#123;</span><br><span class="line">        // AST解析语法树</span><br><span class="line">        let ast = babylon.parse(source)</span><br><span class="line">        let dependencies = []; // 依赖的数组</span><br><span class="line">        // https://astexplorer.net/</span><br><span class="line">        traverse(ast, &#123;</span><br><span class="line">            // 调用表达式</span><br><span class="line">            CallExpression(p) &#123;</span><br><span class="line">                let node = p.node; //对应的节点</span><br><span class="line">                if(node.callee.name === &#x27;require&#x27;) &#123;</span><br><span class="line">                   node.callee.name = &#x27;__webpack_require__&#x27;</span><br><span class="line">                    let moduledName = node.arguments[0].value   // 取到模块的引用名字</span><br><span class="line">                    moduledName = moduledName + (path.extname(moduledName) ? &#x27;&#x27;: &#x27;.js&#x27;);  // ./a.js</span><br><span class="line">                    moduledName = &#x27;./&#x27; + path.join(parentPath, moduledName)  // &#x27;./src/a.js&#x27;</span><br><span class="line">                    dependencies.push(moduledName)</span><br><span class="line">                    node.arguments = [type.stringLiteral(moduledName)] // 改掉源码</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        let sourceCode = generator(ast).code</span><br><span class="line">        return &#123; sourceCode, dependencies &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // 构建模块</span><br><span class="line">    buildModule(modulePath, isEntry) &#123;</span><br><span class="line">        // 拿到模块内容</span><br><span class="line">        let source = this.getSource(modulePath)  // 得到入口文件的内容</span><br><span class="line">        // 模块id modulePath(需要相对路径) = modulePath(模块路径) - this.root(项目工作路径)   src/index.js</span><br><span class="line">        let moduleName = &#x27;./&#x27; + path.relative(this.root, modulePath)</span><br><span class="line">        // console.log(source, moduleName);  // 拿到代码 和相对路径 ./src/index.js</span><br><span class="line">        if (isEntry) &#123;</span><br><span class="line">            this.entryId = moduleName</span><br><span class="line">        &#125;</span><br><span class="line">        // 解析把source源码进行改造， 返回一个依赖列表</span><br><span class="line">        let &#123;sourceCode, dependencies&#125; = this.parse(source, path.dirname(moduleName))   // ./src</span><br><span class="line">        // 把相对路径和模块中的内容对应起来</span><br><span class="line">        this.modules[moduleName] = sourceCode</span><br><span class="line">        dependencies.forEach(dep =&gt; &#123;  // 附模块的加载 递归加载</span><br><span class="line">            this.buildModule(path.join(this.root, dep), false)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 发射文件</span><br><span class="line">    emitFile() &#123;</span><br><span class="line">        // 用数据 渲染想要的</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    run() &#123;</span><br><span class="line">        // 执行 创建模块的依赖关系</span><br><span class="line">        this.buildModule(path.resolve(this.root, this.entry), true)  // path.resolve(this.root, this.entry) 得到入口文件的绝对路径</span><br><span class="line">        console.log(this.modules, this.entryId);</span><br><span class="line">        // 发射打包后的文件</span><br><span class="line">        this.emitFile()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = Compiler</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="生成打包工具"><a href="#生成打包工具" class="headerlink" title="生成打包工具"></a>生成打包工具</h2><p>使用ejs模板</p>
<p><code>may-pack</code>中<code>main.ejs</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">(function (modules) &#123;</span><br><span class="line">var installedModules = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">function __webpack_require__(moduleId) &#123;</span><br><span class="line"></span><br><span class="line">if (installedModules[moduleId]) &#123;</span><br><span class="line">return installedModules[moduleId].exports;</span><br><span class="line">&#125;</span><br><span class="line">var module = installedModules[moduleId] = &#123;</span><br><span class="line">i: moduleId,</span><br><span class="line">l: false,</span><br><span class="line">exports: &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);</span><br><span class="line"></span><br><span class="line">module.l = true;</span><br><span class="line"></span><br><span class="line">return module.exports;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// Load entry module and return exports</span><br><span class="line">return __webpack_require__(__webpack_require__.s = &quot;&lt;%-entryId %&gt;&quot;);</span><br><span class="line">&#125;)(&#123;</span><br><span class="line">&lt;% for(let key in modules)&#123; %&gt;</span><br><span class="line">    &quot;&lt;%- key %&gt;&quot;:</span><br><span class="line">    (function (module, exports,__webpack_require__) &#123;</span><br><span class="line">eval(`&lt;%-modules[key] %&gt;`);</span><br><span class="line">&#125;),</span><br><span class="line">&lt;% &#125; %&gt;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://ejs.bootcss.com/">ejs入门</a></p>
<p><code>yarn add ejs</code></p>
<p><code>may-pack</code>中<code>Compiler.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let ejs = require(&#x27;ejs&#x27;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// 发射文件</span><br><span class="line">    emitFile() &#123;</span><br><span class="line">        // 用数据 渲染想要的</span><br><span class="line">        // 输出到那个目录下</span><br><span class="line">        let main = path.join(this.config.output.path, this.config.output.filename)</span><br><span class="line">        let templateStr = this.getSource(path.join(__dirname, &#x27;main.ejs&#x27;))</span><br><span class="line">        let code = ejs.render(templateStr, &#123; entryId: this.entryId, modules: this.modules&#125;)</span><br><span class="line">        this.assets = &#123;&#125;</span><br><span class="line">        // 路径对应的代码</span><br><span class="line">        this.assets[main] = code</span><br><span class="line">        fs.writeFileSync(main, this.assets[main])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在<code>webpack-training</code>项目中运行<code>npx may-pack</code>, 得到<code>bundle.js</code>,运行得到结果</p>
<h2 id="增加loader"><a href="#增加loader" class="headerlink" title="增加loader"></a>增加loader</h2><p>创建<code>loader</code>文件夹，创建<code>less-loader1.js</code>和<code>style-loader1.js</code></p>
<p><code>yarn add less</code></p>
<p><a target="_blank" rel="noopener" href="http://lesscss.cn/#using-less">less使用</a></p>
<p><code>less-loader1.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 将less转为css</span><br><span class="line">let less = require(&#x27;less&#x27;)</span><br><span class="line"></span><br><span class="line">function loader(source) &#123;</span><br><span class="line">    let css = &#x27;&#x27;</span><br><span class="line">    less.render(source, function (err, output) &#123;</span><br><span class="line">        css = output.css</span><br><span class="line">    &#125;)</span><br><span class="line">    css = css.replace(/\n/g, &#x27;\\n&#x27;);</span><br><span class="line">    return css</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = loader</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>style-loader1.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// 将css插入到html头部</span><br><span class="line">function loader(source) &#123;</span><br><span class="line">    console.log(111);</span><br><span class="line">    let style = `</span><br><span class="line">    let style = document.createElement(&#x27;style&#x27;)</span><br><span class="line">    style.innerHTML = $&#123;JSON.stringify(source)&#125;</span><br><span class="line">    document.head.appendChild(style)</span><br><span class="line">   `</span><br><span class="line">    return style</span><br><span class="line">&#125;</span><br><span class="line">module.exports = loader</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// JSON.stringify(source) 可以将代码转为一行</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>webpack.config.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">let path = require(&#x27;path&#x27;)</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    mode: &#x27;development&#x27;,</span><br><span class="line">    entry: &#x27;./src/index.js&#x27;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: &#x27;bundle.js&#x27;,</span><br><span class="line">        path: path.resolve(__dirname, &#x27;dist&#x27;)</span><br><span class="line">    &#125;,</span><br><span class="line">    module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: /\.less$/,</span><br><span class="line">                use: [</span><br><span class="line">                    path.resolve(__dirname, &#x27;loader&#x27;, &#x27;style-loader1&#x27;),</span><br><span class="line">                    path.resolve(__dirname, &#x27;loader&#x27;, &#x27;less-loader1&#x27;)</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>创建<code>index.less</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">body &#123;</span><br><span class="line">  background: red</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>index.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let str = require(&#x27;./a.js&#x27;)</span><br><span class="line"></span><br><span class="line">require(&#x27;./index.less&#x27;)</span><br><span class="line"></span><br><span class="line">console.log(str);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>may-pack</code>中<code>Compiler.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// 拿到模块内容</span><br><span class="line">    getSource (modulePath) &#123;</span><br><span class="line">        // 匹配各种文件的规则</span><br><span class="line">        let rules= this.config.module.rules;   // webpack.config.js 中rules的数组</span><br><span class="line">        let content = fs.readFileSync(modulePath, &#x27;utf8&#x27;)</span><br><span class="line"></span><br><span class="line">        for (let i = 0; i &lt; rules.length; i++) &#123;</span><br><span class="line">            let rule = rules[i]</span><br><span class="line">            let &#123;test, use&#125; = rule</span><br><span class="line">            let len = use.length - 1</span><br><span class="line"></span><br><span class="line">            if (test.test(modulePath)) &#123;</span><br><span class="line">                // console.log(use[len]);</span><br><span class="line">                function normalLoader () &#123;</span><br><span class="line">                    // console.log(use[len--]);</span><br><span class="line">                    let loader = require(use[len--])</span><br><span class="line">                    content = loader(content)</span><br><span class="line">                    // 递归调用loader 实现转化</span><br><span class="line">                    if (len &gt;= 0) &#123;</span><br><span class="line">                        normalLoader()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                normalLoader()</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        return content</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行<code>npx may-pack</code></p>
<h2 id="增加plugins"><a href="#增加plugins" class="headerlink" title="增加plugins"></a>增加plugins</h2><p><code>yarn add tapable</code></p>
<p><code>may-pack</code>中<code>Compiler.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">constructor(config) &#123;</span><br><span class="line">        // entry  output</span><br><span class="line">        this.config = config</span><br><span class="line">        // 需要保存入口文件的路径</span><br><span class="line">        this.entryId = &#x27;&#x27;;   // &#x27;./src/index.js&#x27;</span><br><span class="line">        // 需要保存所有的模块依赖</span><br><span class="line">        this.modules = &#123;&#125;;</span><br><span class="line">        this.entry = config.entry  // 入口文件</span><br><span class="line">        // 工作目录</span><br><span class="line">        this.root = process.cwd(); // 当前运行npx的路径</span><br><span class="line"></span><br><span class="line">        this.hooks = &#123;</span><br><span class="line">            entryOption: new SyncHook(),  // 入口选项</span><br><span class="line">            compile: new SyncHook(),      // 编译</span><br><span class="line">            afterCompile: new SyncHook(),  // 编译完成</span><br><span class="line">            afterPlugins: new SyncHook(),   // 编译完插件</span><br><span class="line">            run: new SyncHook(),         // 运行</span><br><span class="line">            emit: new SyncHook(),        // 发射</span><br><span class="line">            done: new SyncHook()         // 完成</span><br><span class="line">        &#125;</span><br><span class="line">        // 如果传递了plugins参数</span><br><span class="line">        let plugins = this.config.plugins</span><br><span class="line">        if (Array.isArray(plugins)) &#123;</span><br><span class="line">            plugins.forEach(plugin =&gt; &#123;</span><br><span class="line">                plugin.apply(this); // 这里只是appLy方法不是改变this指向</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        this.hooks.afterPlugins.call()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在<code>webpack.config.js</code>中写插件方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">class P &#123;</span><br><span class="line">    apply(compiler) &#123;   // 这里只是appLy方法不是改变this指向</span><br><span class="line">        // 绑定</span><br><span class="line">        compiler.hooks.emit.tap(&#x27;emit&#x27;, function () &#123;</span><br><span class="line">            console.log(&#x27;emit&#x27;);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class P1 &#123;</span><br><span class="line">    apply(compiler) &#123;   // 这里只是appLy方法不是改变this指向</span><br><span class="line">        // 绑定</span><br><span class="line">        compiler.hooks.afterPlugins.tap(&#x27;emit&#x27;, function () &#123;</span><br><span class="line">            console.log(&#x27;afterPlugins&#x27;);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    mode: &#x27;development&#x27;,</span><br><span class="line">    entry: &#x27;./src/index.js&#x27;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: &#x27;bundle.js&#x27;,</span><br><span class="line">        path: path.resolve(__dirname, &#x27;dist&#x27;)</span><br><span class="line">    &#125;,</span><br><span class="line">    module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: /\.less$/,</span><br><span class="line">                use: [</span><br><span class="line">                    path.resolve(__dirname, &#x27;loader&#x27;, &#x27;style-loader&#x27;),</span><br><span class="line">                    path.resolve(__dirname, &#x27;loader&#x27;, &#x27;less-loader&#x27;)</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        new P(),</span><br><span class="line">        new P1()</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后在各个地方调用</p>
<p><code>may-pack</code>中<code>may-pack.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.....</span><br><span class="line">// 调用</span><br><span class="line">compiler.hooks.entryOption.call()</span><br><span class="line">// 标识运行编译</span><br><span class="line">compiler.run()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>may-pack</code>中<code>Compiler.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">run() &#123;</span><br><span class="line">        this.hooks.run.call()</span><br><span class="line"></span><br><span class="line">        this.hooks.compile.call()</span><br><span class="line">        // 执行 创建模块的依赖关系</span><br><span class="line">        this.buildModule(path.resolve(this.root, this.entry), true)  // path.resolve(this.root, this.entry) 得到入口文件的绝对路径</span><br><span class="line">        // console.log(this.modules, this.entryId);</span><br><span class="line">        this.hooks.afterCompile.call()</span><br><span class="line">        // 发射打包后的文件</span><br><span class="line">        this.emitFile()</span><br><span class="line">        this.hooks.emit.call()</span><br><span class="line">        this.hooks.done.call()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行<code>npx may-pack</code></p>
<h2 id="loader"><a href="#loader" class="headerlink" title="loader"></a>loader</h2><p><a target="_blank" rel="noopener" href="https://juejin.im/post/59e6a5de518825469c7461da">手写loader</a></p>
<p><code>webapck.config.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">let path = require(&#x27;path&#x27;)</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    mode: &#x27;development&#x27;,</span><br><span class="line">    entry: &#x27;./src/index&#x27;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: &#x27;build.js&#x27;,</span><br><span class="line">        path: path.resolve(__dirname, &#x27;dist&#x27;)</span><br><span class="line">    &#125;,</span><br><span class="line">    module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: /\.js/,</span><br><span class="line">                use: &#x27;loader1&#x27; // 如何找到这个loader1</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>创建<code>loader</code>文件<code>loader1.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">console.log(22);</span><br><span class="line"></span><br><span class="line">function loader(source) &#123;  // loader的参数就是源代码</span><br><span class="line">    return source</span><br><span class="line">&#125;</span><br><span class="line">module.exports = loader</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>webpack.config.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">let path = require(&#x27;path&#x27;)</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    mode: &#x27;development&#x27;,</span><br><span class="line">    entry: &#x27;./src/index.js&#x27;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: &#x27;build.js&#x27;,</span><br><span class="line">        path: path.resolve(__dirname, &#x27;dist&#x27;)</span><br><span class="line">    &#125;,</span><br><span class="line">    resolveLoader: &#123;</span><br><span class="line">      // 别名</span><br><span class="line">      // alias: &#123;</span><br><span class="line">      //     loader1: path.resolve(__dirname, &#x27;loader&#x27;, &#x27;loader1&#x27;)</span><br><span class="line">      // &#125;</span><br><span class="line">        modules: [&#x27;node_modules&#x27;, path.resolve(__dirname, &#x27;loader&#x27;)]  // 先找node_modules, 再去loader中去找</span><br><span class="line">    &#125;,</span><br><span class="line">    module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: /\.js$/,</span><br><span class="line">                // use: [path.resolve(__dirname, &#x27;loader&#x27;, &#x27;loader1&#x27;)]</span><br><span class="line">                use: &#x27;loader1&#x27; // 如何找到这个loader1</span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line">            // &#123;</span><br><span class="line">            //     test: /\.less$/,</span><br><span class="line">            //     use: [</span><br><span class="line">            //         path.resolve(__dirname, &#x27;loader&#x27;, &#x27;style-loader&#x27;),</span><br><span class="line">            //         path.resolve(__dirname, &#x27;loader&#x27;, &#x27;less-loader&#x27;)</span><br><span class="line">            //     ]</span><br><span class="line">            // &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如何找到这个<code>loader1</code></p>
<ol>
<li>通过配别名<code>alias</code></li>
<li>通过<code>modules</code></li>
</ol>
<p><code>npx webpack</code></p>
<h2 id="配置多个loader"><a href="#配置多个loader" class="headerlink" title="配置多个loader"></a>配置多个loader</h2><ol>
<li>数组方式</li>
</ol>
<p>先分别在<code>loader</code>文件下创建，<code>loader2.js</code>和<code>loader3.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function loader(source) &#123;  // loader的参数就是源代码</span><br><span class="line">    console.log(&#x27;loader2&#x27;);  // loader3.js 类似</span><br><span class="line">    return source</span><br><span class="line">&#125;</span><br><span class="line">module.exports = loader</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>webpack.config.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rules: [</span><br><span class="line">    &#123;</span><br><span class="line">        test: /\.js$/,</span><br><span class="line">        use: [&#x27;loader3&#x27;, &#x27;loader2&#x27;, &#x27;loader1&#x27;]</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行<code>npx webpack</code>,分别打出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">loader1</span><br><span class="line">loader2</span><br><span class="line">loader3</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>对象方式</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">rules: [</span><br><span class="line">    &#123;</span><br><span class="line">        test: /\.js$/,</span><br><span class="line">        use: [&#x27;loader3&#x27;]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        test: /\.js$/,</span><br><span class="line">        use: [&#x27;loader2&#x27;]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        test: /\.js$/,</span><br><span class="line">        use: [&#x27;loader1&#x27;]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行<code>npx webpack</code>,分别打出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">loader1</span><br><span class="line">loader2</span><br><span class="line">loader3</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>loader</code>的顺序: 从右到左, 从下到上</p>
</blockquote>
<p>也可以通过配置不同的参数改变<code>loader</code>的执行顺序，<code>pre</code> 前面的， <code>post</code>在后面的， <code>normal</code>正常</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: /\.js$/,</span><br><span class="line">    use: [&#x27;loader1&#x27;],</span><br><span class="line">    enforce: &quot;pre&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">    test: /\.js$/,</span><br><span class="line">    use: [&#x27;loader2&#x27;]</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">    test: /\.js$/,</span><br><span class="line">    use: [&#x27;loader3&#x27;],</span><br><span class="line">    enforce: &quot;post&quot;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>loader</code> 带参数执行的顺序: <code>pre  -&gt; normal -&gt; inline -&gt; post</code></p>
<p><code>inline</code>为行内<code>loader</code></p>
<p>在<code>loader</code>文件中新建<code>inlin-loader</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function loader(source) &#123;  // loader的参数就是源代码</span><br><span class="line">    console.log(&#x27;inline&#x27;);</span><br><span class="line">    return source</span><br><span class="line">&#125;</span><br><span class="line">module.exports = loader</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>src/a.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#x27;may&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>src/index</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">console.log(&#x27;hello&#x27;)</span><br><span class="line">let srt = require(&#x27;-!inline-loader!./a&#x27;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol>
<li><code>-!</code>禁用<code>pre-loader</code>和 <code>normal-loader</code>来处理了</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">loader1</span><br><span class="line">loader2</span><br><span class="line">loader3</span><br><span class="line">inline</span><br><span class="line">loader3</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ol start="2">
<li><code>!</code>禁用<code>normal-loader</code></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">loader1</span><br><span class="line">loader2</span><br><span class="line">loader3</span><br><span class="line">loader1</span><br><span class="line">inline</span><br><span class="line">loader3</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ol start="3">
<li><code>!!</code> 禁用<code>pre-loader</code>、<code>normal-loader</code>、<code>post-loader</code>,只能行内处理</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">loader1</span><br><span class="line">loader2</span><br><span class="line">loader3</span><br><span class="line">inline</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>loader 默认由两部分组成<code>pitch</code>和<code>normal</code></p>
<p><code>user: [loader3, loader2, loader1]</code></p>
<p>无返回值: 先执行pitch方法,从左到右，再获取资源</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    pitch loader - 无返回值</span><br><span class="line">    </span><br><span class="line">pitch   loader3 → loader2 → loader1  </span><br><span class="line">                                    ↘</span><br><span class="line">                                      资源</span><br><span class="line">                                    ↙</span><br><span class="line">normal   loader3 ← loader2 ← loader1 </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>有返回值: 直接跳过后续所有的<code>loader</code>包括自己的,跳到之前的<code>loader</code>, 可用于阻断</p>
<p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/api/loaders/">loader</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">user: [loader3, loader2, loader1]</span><br><span class="line"></span><br><span class="line">    pitch loader - 有返回值</span><br><span class="line">    </span><br><span class="line">pitch   loader3 → loader2  loader1  </span><br><span class="line">                     ↙               </span><br><span class="line">               有返回值               资源</span><br><span class="line">               ↙                      </span><br><span class="line">normal  loader3  loader2  loader1 </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>loadeer2.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function loader(source) &#123;  // loader的参数就是源代码</span><br><span class="line">    console.log(&#x27;loader2&#x27;);</span><br><span class="line">    return source</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">loader.pitch = function () &#123;</span><br><span class="line">    return &#x27;111&#x27;</span><br><span class="line">&#125;</span><br><span class="line">module.exports = loader</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">loader3</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="babel-loader实现"><a href="#babel-loader实现" class="headerlink" title="babel-loader实现"></a><code>babel-loader</code>实现</h2><p><code>yarn add @babel/core @babel/preset-env</code></p>
<p><code>webpack.config.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: &#x27;\.js$/&#x27;,</span><br><span class="line">    use: &#123;</span><br><span class="line">        loader: &#x27;babel-loader2&#x27;,</span><br><span class="line">        options: &#123;</span><br><span class="line">            presets: [</span><br><span class="line">                &#x27;@babel/preset-env&#x27;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在<code>loader</code>文件创建<code>babel-loader2.js</code>(如果你已经装过<code>babel-loader</code>)</p>
<p>拿到<code>babel</code>的参数</p>
<p><code>yarn add loader-utils</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">// 需要在webpack.config.js拿到babel的预设, 通过预设转换模块, 先引入babel</span><br><span class="line">let babel = require(&#x27;@babel/core&#x27;)</span><br><span class="line"></span><br><span class="line">// 拿到babel的参数 需要工具 loaderUtils</span><br><span class="line">let loaderUtils =require(&#x27;loader-utils&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function loader(source) &#123;  // loader的参数就是源代码  这里的this就是loader的上下文</span><br><span class="line">    let options = loaderUtils.getOptions(this)</span><br><span class="line">    console.log(this.resourcePath, 444);   // [./src/index.js]</span><br><span class="line">    let callback = this.async(); // babel的转换是异步的,同步的返回是不行的， 不能用return  同步就是直接掉用 异步会在async中</span><br><span class="line">    babel.transform(source, &#123;</span><br><span class="line">        ...options,</span><br><span class="line">        sourceMap: true,         // 是否设置sourceMap 还需要再webpack.config.js 中配置  devtool: &#x27;source-map&#x27;</span><br><span class="line">        filename: this.resourcePath.split(&#x27;/&#x27;).pop()   //  给生成的`source-map`指定名字</span><br><span class="line">    &#125;, function (err, result) &#123;</span><br><span class="line">        callback(err, result.code, result.map)   // 异步 参数分别是「错误 转化后的代码 和 sourceMap」</span><br><span class="line">    &#125;)</span><br><span class="line">    console.log(options);</span><br><span class="line">    // return source  失效</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = loader</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>index.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">class May &#123;</span><br><span class="line">    constructor () &#123;</span><br><span class="line">        this.name = &#x27;may&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">    getName () &#123;</span><br><span class="line">        return this.name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">let may = new May()</span><br><span class="line"></span><br><span class="line">console.log(may.getName());</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>npx webpack</code></p>
<h2 id="banner-loader实现-自创"><a href="#banner-loader实现-自创" class="headerlink" title="banner-loader实现(自创)"></a><code>banner-loader</code>实现(自创)</h2><p>给所有匹配的<code>js</code>加一个注释</p>
<p><code>webpack.config.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;    // 给所有匹配的`js`加一个注释</span><br><span class="line">    test: /\.js$/,</span><br><span class="line">    use: &#123;</span><br><span class="line">        loader: &#x27;banner-loader&#x27;,</span><br><span class="line">        options: &#123;</span><br><span class="line">           text: &#x27;may&#x27;,</span><br><span class="line">           filename: path.resolve(__dirname, &#x27;banner.js&#x27;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>banner.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">二次星球中毒</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在<code>loader</code>文件创建<code>banner-loader.js</code></p>
<p><code>yarn add schema-utils</code> 校验自己写的<code>loader</code>格式是否正确</p>
<p><a target="_blank" rel="noopener" href="https://github.com/webpack-contrib/schema-utils">schema-utils</a></p>
<p><code>banner-loader.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">// 拿到loader的配置</span><br><span class="line">let loaderUtils = require(&#x27;loader-utils&#x27;)</span><br><span class="line">// 校验loader</span><br><span class="line">let validateOptions = require(&#x27;schema-utils&#x27;)</span><br><span class="line">// 读取文件</span><br><span class="line">let fs = require(&#x27;fs&#x27;)  // 异步</span><br><span class="line"></span><br><span class="line">function loader(source) &#123;  // loader的参数就是源代码</span><br><span class="line">    let options = loaderUtils.getOptions(this)</span><br><span class="line">    let callback = this.async()  // 读取文件是异步</span><br><span class="line">    let schema = &#123;</span><br><span class="line">        type: &#x27;object&#x27;,</span><br><span class="line">        properties: &#123;</span><br><span class="line">            text: &#123;</span><br><span class="line">                type: &#x27;string&#x27;</span><br><span class="line">            &#125;,</span><br><span class="line">            filename: &#123;</span><br><span class="line">                type: &#x27;string&#x27;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    validateOptions(schema, options, &#x27;banner-loader&#x27;)  // 自己的校验格式， 自己的写的配置， 对应的loader名字</span><br><span class="line">    if (options.filename) &#123;</span><br><span class="line">        this.cacheable(false)  // 不要缓存  如果有大量计算 推荐缓存</span><br><span class="line">        // this.cacheable &amp;&amp; this.cacheable()</span><br><span class="line">        this.addDependency(options.filename) // 自动增加依赖</span><br><span class="line">        fs.readFile(options.filename, &#x27;utf8&#x27;, function (err, data) &#123;</span><br><span class="line">            callback(err, `/**$&#123;data&#125;**/$&#123;source&#125;`)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        callback(null, `/**$&#123;options.text&#125;**/$&#123;source&#125;`)</span><br><span class="line">    &#125;</span><br><span class="line">    return source</span><br><span class="line">&#125;</span><br><span class="line">module.exports = loader</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>优化:</p>
<ol>
<li>修改<code>banner.js</code>的内容后, <code>webpack</code>进行监控，打包<code>webapck.config.js</code>配置<code>watch: true</code></li>
<li><code>loader</code>缓存</li>
</ol>
<h2 id="实现file-loader和url-loader"><a href="#实现file-loader和url-loader" class="headerlink" title="实现file-loader和url-loader"></a>实现<code>file-loader</code>和<code>url-loader</code></h2><p><code>yarn add mime</code></p>
<p>其主要用途是设置某种扩展名的文件的响应程序类型</p>
<p><a target="_blank" rel="noopener" href="https://github.com/broofa/node-mime#readme">mime</a></p>
<p>创建<code>file-loader.js1</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// 拿到babel的参数 需要工具 loaderUtils</span><br><span class="line">let loaderUtils = require(&#x27;loader-utils&#x27;)</span><br><span class="line"></span><br><span class="line">function loader(source) &#123;  // loader的参数就是源代码</span><br><span class="line">    // file-loader需要返回路径</span><br><span class="line">    let filename = loaderUtils.interpolateName(this, &#x27;[hash].[ext]&#x27;, &#123;content: source &#125;)</span><br><span class="line">    this.emitFile(filename, source) // 发射文件</span><br><span class="line">    console.log(&#x27;loader1&#x27;);</span><br><span class="line">    return `module.exports=&quot;$&#123;filename&#125;&quot;`</span><br><span class="line">&#125;</span><br><span class="line">loader.raw = true // 二进制</span><br><span class="line">module.exports = loader</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>创建<code>url-loader1.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// 拿到babel的参数 需要工具 loaderUtils</span><br><span class="line">let loaderUtils = require(&#x27;loader-utils&#x27;)</span><br><span class="line">let mime = require(&#x27;mime&#x27;)  // 途是设置某种扩展名的文件的响应程序类型</span><br><span class="line"></span><br><span class="line">function loader(source) &#123;  // loader的参数就是源代码</span><br><span class="line">    let &#123;limit&#125; = loaderUtils.getOptions(this)</span><br><span class="line">    console.log(this.resourcePath);</span><br><span class="line">    if (limit &amp;&amp; limit &gt; source.length) &#123;</span><br><span class="line">        return `module.exports=&quot;data:$&#123;mime.getType(this.resourcePath)&#125;;base64,$&#123;source.toString(&#x27;base64&#x27;)&#125;&quot;`</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        return require(&#x27;./file-loader1&#x27;).call(this, source)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">loader.raw = true // 二进制</span><br><span class="line">module.exports = loader</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>webpack.config.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: /\.png$/,</span><br><span class="line">    // 目的是根据图片生成md5 发射到dist目录下，file-loader 返回当前图片路径</span><br><span class="line">    // use: &#x27;file-loader&#x27;</span><br><span class="line">    // 处理路径</span><br><span class="line">    use: &#123;</span><br><span class="line">        loader: &#x27;url-loader1&#x27;,</span><br><span class="line">        options: &#123;</span><br><span class="line">            limit: 200 * 1024</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>index.js</code>引入图片</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import p from &#x27;./photo.png&#x27;</span><br><span class="line"></span><br><span class="line">let img = document.createElement(&#x27;img&#x27;)</span><br><span class="line">img.src = p</span><br><span class="line">document.body.appendChild(img);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="less-loader和css-loader"><a href="#less-loader和css-loader" class="headerlink" title="less-loader和css-loader"></a><code>less-loader</code>和<code>css-loader</code></h2><p>先安装<code>less</code></p>
<p>分别创建<code>style-loader2</code> <code>css-loader2</code> <code>less-loader2</code></p>
<p><code>style-loader1</code> 与 <code>less-loader1</code> 同之前的</p>
<h2 id="css-loader"><a href="#css-loader" class="headerlink" title="css-loader"></a><code>css-loader</code></h2><p>主要用来处理<code>css</code>中的图片链接，需要把<code>url</code>转换成<code>require</code></p>
<p><code>webpack.config.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: /\.png$/,</span><br><span class="line">    // 目的是根据图片生成md5 发射到dist目录下，file-loader 返回当前图片路径</span><br><span class="line">    // use: &#x27;file-loader&#x27;</span><br><span class="line">    // 处理路径</span><br><span class="line">    use: &#123;</span><br><span class="line">        loader: &#x27;url-loader1&#x27;,</span><br><span class="line">        options: &#123;</span><br><span class="line">            limit: 200 * 1024</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">    test: /\.less$/,</span><br><span class="line">    use: [&#x27;style-loader2&#x27;, &#x27;css-loader2&#x27;, &#x27;less-loader2&#x27;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>创建<code>index.less</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@base: #f938ab;</span><br><span class="line">body &#123;</span><br><span class="line">  background: @base;</span><br><span class="line">  background: url(&quot;./photo.png&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>less-loader2.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// 将less转为css</span><br><span class="line">let less = require(&#x27;less&#x27;)</span><br><span class="line"></span><br><span class="line">function loader(source) &#123;</span><br><span class="line">    let css = &#x27;&#x27;</span><br><span class="line">    // console.log(source, 2222);</span><br><span class="line">    less.render(source, function (err, output) &#123;</span><br><span class="line">        // console.log(output);</span><br><span class="line">        css = output.css</span><br><span class="line">    &#125;)</span><br><span class="line">    // css = css.replace(/\n/g, &#x27;\\n&#x27;);</span><br><span class="line">    return css</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = loader</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>css-loader2.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">// css-loader 用来解析@import这种语法,包括css中引入的图片</span><br><span class="line">function loader(source) &#123;</span><br><span class="line">    let reg = /url\((.+?)\)/g   // 匹配括号</span><br><span class="line"></span><br><span class="line">    let pos = 0;</span><br><span class="line">    let current;</span><br><span class="line"></span><br><span class="line">    let arr = [&#x27;let list = []&#x27;]</span><br><span class="line"></span><br><span class="line">    while (current = reg.exec(source)) &#123;</span><br><span class="line">        let [matchUrl, g] = current   // matchUrl -&gt; &#x27;url(&quot;./photo.png&quot;)&#x27;, g  -&gt; &#x27;&quot;./photo.png&quot;&#x27;</span><br><span class="line">        // console.log(matchUrl, g, 88);</span><br><span class="line">        let lastIndex = reg.lastIndex - matchUrl.length    // 拿到css从开通到地址链接之前的index</span><br><span class="line">        arr.push(`list.push($&#123;JSON.stringify(source.slice(pos, lastIndex))&#125;)`)  // 拼入开始和地址之前的代码</span><br><span class="line">        pos = reg.lastIndex</span><br><span class="line">        arr.push(`list.push(&#x27;url(&#x27;+ require($&#123;g&#125;) +&#x27;)&#x27;)`)    // 拼入图片地址</span><br><span class="line">    &#125;</span><br><span class="line">    arr.push(`list.push($&#123;JSON.stringify(source.slice(pos))&#125;)`)  // 拼入地址到结尾的代码</span><br><span class="line">    arr.push(`module.exports = list.join(&#x27;&#x27;)`)</span><br><span class="line">    console.log(arr.join(&#x27;\r\n&#x27;));</span><br><span class="line">    // let list = []</span><br><span class="line">    // list.push(&quot;body &#123;\\n  background: #f938ab;\\n  background: &quot;)</span><br><span class="line">    // list.push(&#x27;url(&#x27;+ require(&quot;./photo.png&quot;) +&#x27;)&#x27;)</span><br><span class="line">    // list.push(&quot;;\\n&#125;\\n&quot;)</span><br><span class="line">    // module.exports = list.join(&#x27;&#x27;)</span><br><span class="line"></span><br><span class="line">    return arr.join(&#x27;\r\n&#x27;)</span><br><span class="line">&#125;</span><br><span class="line">module.exports = loader</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>style-loader2.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">let loaderUtils = require(&#x27;loader-utils&#x27;)</span><br><span class="line"></span><br><span class="line">// 将css插入到html头部</span><br><span class="line">function loader(source) &#123;</span><br><span class="line">    let str = `</span><br><span class="line">    let style = document.createElement(&#x27;style&#x27;)</span><br><span class="line">    style.innerHTML = $&#123;JSON.stringify(source)&#125;</span><br><span class="line">    document.head.appendChild(style)</span><br><span class="line">   `</span><br><span class="line">    return str</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// style-loader写了pitch,有返回后面的跳过，自己的写不会走</span><br><span class="line">loader.pitch = function (remainingRequest) &#123;  // 剩余的请求</span><br><span class="line">    console.log(loaderUtils.stringifyRequest(this, &#x27;!!&#x27; + remainingRequest, 99999999))</span><br><span class="line">    // 让style-loader 处理 less-loader 和css-loader拼接的结果</span><br><span class="line">    // 得到 /Users/liuhuimin/work/webpack/loader/css-loader2.js!/Users/liuhuimin/work/webpack/loader/less-loader2.js!/Users/liuhuimin/work/webpack/src/index.less</span><br><span class="line">    // 剩余的请求 less-loader!css-loader!./index.less</span><br><span class="line">    // console.log(remainingRequest, 1223);</span><br><span class="line">    // require返回的就是css-loader处理好的结果require(&#x27;!!css-loader!less-loader!./index.less&#x27;)</span><br><span class="line">    let str = `</span><br><span class="line">    let style = document.createElement(&#x27;style&#x27;)</span><br><span class="line">    style.innerHTML = require($&#123;loaderUtils.stringifyRequest(this, &#x27;!!&#x27; + remainingRequest)&#125;)</span><br><span class="line">    document.head.appendChild(style)</span><br><span class="line">   `</span><br><span class="line">    // stringifyRequest 绝对路径转相对路径</span><br><span class="line">    return str</span><br><span class="line">&#125;</span><br><span class="line">module.exports = loader</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">user: [&#x27;style-loader2&#x27;, &#x27;css-loader2&#x27;, &#x27;less-loader2&#x27;]</span><br><span class="line"></span><br><span class="line">    pitch loader - 有返回值</span><br><span class="line">    </span><br><span class="line">pitch   style-loader2 → css-loader2  less-loader2  </span><br><span class="line">                     ↙               </span><br><span class="line">               有返回值               资源</span><br><span class="line">               ↙                      </span><br><span class="line">normal  style-loader2  css-loader2  less-loader2</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在<code>style-loader2</code>中 引用了<code>less-loader</code> <code>css-loader</code> 和<code>less</code>文件</p>
<h2 id="webpack-中的插件"><a href="#webpack-中的插件" class="headerlink" title="webpack 中的插件"></a>webpack 中的插件</h2><p><code>yarn add webpack webpack-cil -D</code></p>
<p><code>webpack.config.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">let path = require(&#x27;path&#x27;)</span><br><span class="line">let DonePlugin = require(&#x27;./plugins/DonePlugins&#x27;)</span><br><span class="line">let AsyncPlugins = require(&#x27;./plugins/AsyncPlugins&#x27;)</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    mode: &#x27;development&#x27;,</span><br><span class="line">    entry: &#x27;./src/index.js&#x27;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: &#x27;build.js&#x27;,</span><br><span class="line">        path: path.resolve(__dirname, &#x27;dist&#x27;)</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        new DonePlugin(),    // 同步</span><br><span class="line">        new AsyncPlugins()   // 异步</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>node_modules/webpack/lib</code>中查看<code>Compiler.js</code></p>
<ol>
<li>同步<code>plugins/DonePlugins</code></li>
</ol>
<p>打包完成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class DonePlugins &#123;</span><br><span class="line">    apply (compiler) &#123;</span><br><span class="line">        console.log(1);</span><br><span class="line">        compiler.hooks.done.tap(&#x27;DonePlugin&#x27;, (stats) =&gt; &#123;</span><br><span class="line">            console.log(&#x27;编译完成&#x27;);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">module.exports = DonePlugins</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>异步<code>plugins/AsyncPlugins</code></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">class AsyncPlugins &#123;</span><br><span class="line">    apply (compiler) &#123;</span><br><span class="line">        console.log(2);</span><br><span class="line">        compiler.hooks.emit.tapAsync(&#x27;AsyncPlugin&#x27;, (complete, callback) =&gt; &#123;</span><br><span class="line">            setTimeout(() =&gt; &#123;</span><br><span class="line">                console.log(&#x27;文件发射出来&#x27;);</span><br><span class="line">                callback()</span><br><span class="line">            &#125;, 1000)</span><br><span class="line">        &#125;)</span><br><span class="line">        compiler.hooks.emit.tapPromise(&#x27;AsyncPlugin&#x27;, (complete, callback) =&gt; &#123;</span><br><span class="line">            return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">                setTimeout(() =&gt; &#123;</span><br><span class="line">                    console.log(&#x27;文件发射出来 222&#x27;);</span><br><span class="line">                    resolve()</span><br><span class="line">                &#125;, 1000)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">module.exports = AsyncPlugins</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="文件列表插件"><a href="#文件列表插件" class="headerlink" title="文件列表插件"></a>文件列表插件</h2><p>希望生成一个文件描述打包出来的文件</p>
<p>在<code>plugins</code>中新建<code>FileListPlugin</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">class FileListPlugin &#123;</span><br><span class="line">    constructor (&#123;filename&#125;) &#123;</span><br><span class="line">        this.filename = filename</span><br><span class="line">    &#125;</span><br><span class="line">    apply (compiler) &#123;</span><br><span class="line">        // 文件已经准备好了 要进行发射</span><br><span class="line">        // emit</span><br><span class="line">        compiler.hooks.emit.tap(&#x27;FileListPlugin&#x27;, (compilation) =&gt; &#123;</span><br><span class="line">            let assets = compilation.assets;</span><br><span class="line">            console.log(assets, 55);</span><br><span class="line">            let content = `## 文件名  资源大小\r\n`</span><br><span class="line">            // [ [bundls.js, &#123;&#125;], [index.html, &#123;&#125;]]</span><br><span class="line">            Object.entries(assets).forEach(([filename, stateObj]) =&gt; &#123;</span><br><span class="line">                content += `- $&#123;filename&#125;    $&#123;stateObj.size()&#125;\r\n`</span><br><span class="line">            &#125;)</span><br><span class="line">            // 资源对象</span><br><span class="line">            assets[this.filename] = &#123;</span><br><span class="line">                source () &#123;</span><br><span class="line">                    return content;</span><br><span class="line">                &#125;,</span><br><span class="line">                size () &#123;</span><br><span class="line">                    return content.length</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = FileListPlugin</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">let path = require(&#x27;path&#x27;)</span><br><span class="line">let DonePlugin = require(&#x27;./plugins/DonePlugins&#x27;)</span><br><span class="line">let AsyncPlugins = require(&#x27;./plugins/AsyncPlugins&#x27;)</span><br><span class="line">let HtmlWebpackPlugin = require(&#x27;html-webpack-plugin&#x27;)</span><br><span class="line">let FileListPlugin = require(&#x27;./plugins/FileListPlugin&#x27;)</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    mode: &#x27;development&#x27;,</span><br><span class="line">    entry: &#x27;./src/index.js&#x27;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: &#x27;build.js&#x27;,</span><br><span class="line">        path: path.resolve(__dirname, &#x27;dist&#x27;)</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        new DonePlugin(),</span><br><span class="line">        new AsyncPlugins(),</span><br><span class="line">        new HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: &#x27;./src/index.html&#x27;,</span><br><span class="line">            filename: &#x27;index.html&#x27;</span><br><span class="line">        &#125;),</span><br><span class="line">        new FileListPlugin(&#123;</span><br><span class="line">            filename: &#x27;list.md&#x27;</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>生成<code>list.md</code></p>
<h2 id="内联的webpack插件"><a href="#内联的webpack插件" class="headerlink" title="内联的webpack插件"></a>内联的<code>webpack</code>插件</h2><p>新建<code>index.css</code>引入<code>index.js</code></p>
<p><code>yarn add css-loader mini-css-extract-plugin -D</code></p>
<p>希望打包后<code>css、js</code>内联在<code>index.html</code>文件中</p>
<p>创建<code>plugins</code>中<code>InlineSourcePlugins.js</code></p>
<p><code>yarn add --dev html-webpack-plugin@next</code></p>
<p><a target="_blank" rel="noopener" href="https://github.com/jantimon/html-webpack-plugin">HTML Webpack Plugin</a></p>
<p><code>webpack.config.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">let path = require(&#x27;path&#x27;)</span><br><span class="line">let DonePlugin = require(&#x27;./plugins/DonePlugins&#x27;)</span><br><span class="line">let AsyncPlugins = require(&#x27;./plugins/AsyncPlugins&#x27;)</span><br><span class="line">let HtmlWebpackPlugin = require(&#x27;html-webpack-plugin&#x27;)</span><br><span class="line">let FileListPlugin = require(&#x27;./plugins/FileListPlugin&#x27;)</span><br><span class="line"></span><br><span class="line">let InlineSourcePlugins = require(&#x27;./plugins/InlineSourcePlugins&#x27;)</span><br><span class="line"></span><br><span class="line">let MiniCssExtractPlugin = require(&#x27;mini-css-extract-plugin&#x27;)</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    mode: &#x27;production&#x27;,</span><br><span class="line">    entry: &#x27;./src/index.js&#x27;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: &#x27;bundle.js&#x27;,</span><br><span class="line">        path: path.resolve(__dirname, &#x27;dist&#x27;)</span><br><span class="line">    &#125;,</span><br><span class="line">    module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: /\.css$/,</span><br><span class="line">                use: [MiniCssExtractPlugin.loader, &#x27;css-loader&#x27;]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        // new DonePlugin(),</span><br><span class="line">        // new AsyncPlugins(),</span><br><span class="line">        new HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: &#x27;./src/index.html&#x27;,</span><br><span class="line">            filename: &#x27;index.html&#x27;</span><br><span class="line">        &#125;),</span><br><span class="line">        new MiniCssExtractPlugin(&#123;</span><br><span class="line">            filename: &#x27;index.css&#x27;</span><br><span class="line">        &#125;),</span><br><span class="line">        new InlineSourcePlugins(&#123;</span><br><span class="line">            match: /\.(js|css)/</span><br><span class="line">        &#125;),</span><br><span class="line">        // new FileListPlugin(&#123;</span><br><span class="line">        //     filename: &#x27;list.md&#x27;</span><br><span class="line">        // &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>InlineSourcePlugins.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">const HtmlWebpackPlugin = require(&#x27;html-webpack-plugin&#x27;)</span><br><span class="line"></span><br><span class="line">// 把外链的标签编程内联的标签</span><br><span class="line">class InlineSourcePlugins &#123;</span><br><span class="line">    constructor(&#123;match&#125;) &#123;</span><br><span class="line">        this.reg = match  // 正则</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 处理某一个标签</span><br><span class="line">    processTag(tag, compilation) &#123;</span><br><span class="line">        let newTag = &#123;&#125;</span><br><span class="line">        let url = &#x27;&#x27;</span><br><span class="line">        if (tag.tagName === &#x27;link&#x27; &amp;&amp; this.reg.test(tag.attributes.href)) &#123;</span><br><span class="line">            newTag = &#123;</span><br><span class="line">                tagName: &#x27;style&#x27;,</span><br><span class="line">                attributes: &#123;type: &#x27;text/css&#x27;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">            url = tag.attributes.href</span><br><span class="line">        &#125; else if (tag.tagName === &#x27;script&#x27; &amp;&amp; this.reg.test(tag.attributes.src)) &#123;</span><br><span class="line">            newTag = &#123;</span><br><span class="line">                tagName: &#x27;script&#x27;,</span><br><span class="line">                attributes: &#123;type: &#x27;application/javascript&#x27;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">            url = tag.attributes.src</span><br><span class="line">        &#125;</span><br><span class="line">        if (url) &#123;</span><br><span class="line">            newTag.innerHTML = compilation.assets[url].source(); // 文件内容放到innerHTML属性中</span><br><span class="line">            delete compilation.assets[url]   // 删除原有的资源</span><br><span class="line">            return newTag</span><br><span class="line">            // console.log(compilation.assets[url].source());</span><br><span class="line">        &#125;</span><br><span class="line">        return tag</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 处理引入标签的数据</span><br><span class="line">    processTags(data, compilation) &#123;</span><br><span class="line">        let headTags = []</span><br><span class="line">        let bodyTags = []</span><br><span class="line">        data.headTags.forEach(headTag =&gt; &#123;</span><br><span class="line">            headTags.push(this.processTag(headTag, compilation))</span><br><span class="line">        &#125;)</span><br><span class="line">        data.bodyTags.forEach(bodyTag =&gt; &#123;</span><br><span class="line">            bodyTags.push(this.processTag(bodyTag, compilation))</span><br><span class="line">        &#125;)</span><br><span class="line">        console.log(&#123;...data, headTags, bodyTags&#125;)</span><br><span class="line">        return &#123;...data, headTags, bodyTags&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    apply(compiler) &#123;</span><br><span class="line">        // 通过webpackPlugin来实现  npm搜索  html-webpack-plugin</span><br><span class="line">        compiler.hooks.compilation.tap(&#x27;InlineSourcePlugins&#x27;, (compilation) =&gt; &#123;</span><br><span class="line">            HtmlWebpackPlugin.getHooks(compilation).alterAssetTagGroups.tapAsync(</span><br><span class="line">                &#x27;alertPlugin&#x27;,</span><br><span class="line">                (data, callback) =&gt; &#123;</span><br><span class="line">                    // console.log(&#x27;======&#x27;);</span><br><span class="line">                    // console.log(data) // 插入html标签的数据</span><br><span class="line">                    // console.log(&#x27;======&#x27;);</span><br><span class="line">                    data = this.processTags(data, compilation)   // compilation.assets 资源的链接</span><br><span class="line">                    callback(null, data)</span><br><span class="line">                &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = InlineSourcePlugins</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="打包后自动发布"><a href="#打包后自动发布" class="headerlink" title="打包后自动发布"></a>打包后自动发布</h2><p>打包好的文件自动上传致七牛</p>
<p>需要这几个参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bucket: &#x27;&#x27;  // 七牛的存储空间</span><br><span class="line">domain: &#x27;&#x27;,</span><br><span class="line">accessKey: &#x27;&#x27;, // 七牛云的两对密匙</span><br><span class="line">secretKey: &#x27;&#x27; // 七牛云的两对密匙</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>注册七牛，并在对象存储里面,新建存储空间列表<code>test</code>,<code>bucket: &#39;test&#39;</code></p>
<p>内容管理外链接默认域名 <code>domain: &#39;xxxxxxxx&#39;</code></p>
<p>右上角个人面板里面个人中心,密钥管理分别对应<code>accessKey</code>和<code>secretKey</code></p>
<p><a target="_blank" rel="noopener" href="https://developer.qiniu.com/">进入开发者中心</a> -&gt; SDK&amp;工具 -&gt; 官方SDK -&gt; Node服务端文档 —&gt; 文件上传</p>
<p><a target="_blank" rel="noopener" href="https://developer.qiniu.com/kodo/sdk/1289/nodejs">node文件上传</a></p>
<p><code>npm install qiniu</code></p>
<p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/api/compiler-hooks">compiler-hooks</a></p>
<p><code>webpack.config.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">        new HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: &#x27;./src/index.html&#x27;,</span><br><span class="line">            filename: &#x27;index.html&#x27;</span><br><span class="line">        &#125;),</span><br><span class="line">        new MiniCssExtractPlugin(&#123;</span><br><span class="line">            filename: &#x27;index.css&#x27;</span><br><span class="line">        &#125;),</span><br><span class="line">        new UploadPlugin(&#123;</span><br><span class="line">            bucket: &#x27;test&#x27;,  // 七牛的存储空间</span><br><span class="line">            domain: &#x27;poyrjyh1b.bkt.clouddn.com&#x27;,</span><br><span class="line">            accessKey: &#x27;xxxxxx&#x27;, // 七牛云的两对密匙</span><br><span class="line">            secretKey: &#x27;yyyyyy&#x27; // 七牛云的两对密匙</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>UploadPlugin.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">let qiniu = require(&#x27;qiniu&#x27;)</span><br><span class="line">let path = require(&#x27;path&#x27;)</span><br><span class="line"></span><br><span class="line">class UploadPlugin &#123;</span><br><span class="line">    constructor (options = &#123;&#125;) &#123;</span><br><span class="line">        // 参考 https://developer.qiniu.com/kodo/sdk/1289/nodejs</span><br><span class="line">        let &#123; bucket = &#x27;&#x27;, domain = &#x27;&#x27;, accessKey = &#x27;&#x27;, secretKey = &#x27;&#x27;&#125; = options</span><br><span class="line">        let mac = new qiniu.auth.digest.Mac(accessKey, secretKey)</span><br><span class="line">        let putPolicy = new qiniu.rs.PutPolicy(&#123;</span><br><span class="line">            scope: bucket</span><br><span class="line">        &#125;);</span><br><span class="line">        this.uploadToken = putPolicy.uploadToken(mac)</span><br><span class="line">        let config = new qiniu.conf.Config();</span><br><span class="line">        this.formUploader = new qiniu.form_up.FormUploader(config)</span><br><span class="line">        this.putExtra = new qiniu.form_up.PutExtra()</span><br><span class="line">    &#125;</span><br><span class="line">    apply (compiler) &#123;</span><br><span class="line">        compiler.hooks.afterEmit.tapPromise(&#x27;UploadPlugin&#x27;, (complication) =&gt; &#123;</span><br><span class="line">            let assets = complication.assets</span><br><span class="line">            let promise = []</span><br><span class="line">            Object.keys(assets).forEach(filename =&gt; &#123;</span><br><span class="line">                promise.push(this.upload(filename))</span><br><span class="line">            &#125;)</span><br><span class="line">            return Promise.all(promise)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    upload (filename) &#123;</span><br><span class="line">        return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">            let localFile = path.resolve(__dirname, &#x27;../dist&#x27;, filename)</span><br><span class="line">            this.formUploader.putFile(this.uploadToken, filename, localFile, this.putExtra, function(respErr,</span><br><span class="line">                                                                                 respBody, respInfo) &#123;</span><br><span class="line">                if (respErr) &#123;</span><br><span class="line">                    reject(respErr)</span><br><span class="line">                &#125;</span><br><span class="line">                if (respInfo.statusCode == 200) &#123;</span><br><span class="line">                    resolve(respBody)</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    console.log(respInfo.statusCode)</span><br><span class="line">                    console.log(respBody)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = UploadPlugin</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="后续还有持续更新！"><a href="#后续还有持续更新！" class="headerlink" title="后续还有持续更新！"></a>后续还有持续更新！</h3></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:1148567490@qq.com">Mc</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://mcweblog.com/2019/06/14/webpack%E5%88%9D%E5%AD%A6%E4%BD%BF%E7%94%A8/">https://mcweblog.com/2019/06/14/webpack初学使用/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://mcweblog.com" target="_blank">My Web Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7/">打包工具</a><a class="post-meta__tags" href="/tags/webpack/">webpack</a></div><div class="post_share"><div class="social-share" data-image="https://miaochen.mcweblog.com/img%2Fwq5m26.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2019/06/15/book/"><img class="prev-cover" src="https://miaochen.mcweblog.com/img%2Fwq5m26.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">开发相关书籍</div></div></a></div><div class="next-post pull-right"><a href="/2019/06/12/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/"><img class="next-cover" src="https://miaochen.mcweblog.com/img%2Fwq5m26.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">算法和实例</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2019/06/23/Gulp%E5%BF%AB%E9%80%9F%E4%BD%BF%E7%94%A8/" title="Gulp快速使用"><img class="cover" src="https://miaochen.mcweblog.com/img%2Fwq5m26.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-06-23</div><div class="title">Gulp快速使用</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://miaochen.mcweblog.com/img%2F2020_09_11_22_32_IMG_6232.JPG" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Mc</div><div class="author-info__description">Have a nice day!</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">20</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">19</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/miaonima123" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/1148567490@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Building...😓</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#webpack-%E5%AE%89%E8%A3%85"><span class="toc-number">1.</span> <span class="toc-text">webpack 安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E9%85%8D%E7%BD%AEwebpack"><span class="toc-number">2.</span> <span class="toc-text">手动配置webpack</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E6%9C%8D%E5%8A%A1"><span class="toc-number">3.</span> <span class="toc-text">本地服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%86%E6%89%93%E5%8C%85%E5%90%8E%E7%9A%84js%E6%96%87%E4%BB%B6%E5%BC%95%E5%85%A5%E5%88%B0%E7%94%9F%E6%88%90%E7%9A%84html%E6%96%87%E4%BB%B6%E4%B8%AD%E5%B0%86html%E6%96%87%E4%BB%B6%E4%B9%9F%E6%89%93%E5%8C%85"><span class="toc-number">4.</span> <span class="toc-text">将打包后的js文件引入到生成的html文件中将html文件也打包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B7%E5%BC%8F%E5%A4%84%E7%90%86"><span class="toc-number">5.</span> <span class="toc-text">样式处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E7%8B%AC%E6%8A%BD%E7%A6%BBcss%E6%A0%B7%E5%BC%8F%E6%8F%92%E4%BB%B6%E7%94%A8link%E5%BC%95%E5%85%A5"><span class="toc-number">6.</span> <span class="toc-text">单独抽离css样式插件用link引入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E6%A0%B7%E5%BC%8F%E8%87%AA%E5%8A%A8%E6%B7%BB%E5%8A%A0%E5%AF%B9%E5%BA%94%E6%B5%8F%E8%A7%88%E5%99%A8%E5%89%8D%E7%BC%80"><span class="toc-number">7.</span> <span class="toc-text">特殊样式自动添加对应浏览器前缀</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%93%E5%8C%85%E6%8A%BD%E7%A6%BB%E5%87%BA%E4%B9%8B%E5%90%8E%E7%9A%84css%E6%A0%B7%E5%BC%8F"><span class="toc-number">8.</span> <span class="toc-text">打包抽离出之后的css样式**</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8babel%E6%9D%A5%E5%B0%86es6%E8%AF%AD%E6%B3%95%E8%BD%AC%E4%B8%BAes5%E5%A5%BD%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95"><span class="toc-number">9.</span> <span class="toc-text">使用babel来将es6语法转为es5好进行调试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86js%E8%AF%AD%E6%B3%95"><span class="toc-number">10.</span> <span class="toc-text">处理js语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E6%A3%80%E6%9F%A5%E6%A0%A1%E9%AA%8C"><span class="toc-number">11.</span> <span class="toc-text">语法检查校验</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E5%BC%95%E5%85%A5%E9%97%AE%E9%A2%98"><span class="toc-number">12.</span> <span class="toc-text">解决全局变量引入问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86"><span class="toc-number">13.</span> <span class="toc-text">图片处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%93%E5%8C%85%E4%BA%A7%E5%87%BA%E6%96%87%E4%BB%B6%E5%88%86%E7%B1%BB"><span class="toc-number">14.</span> <span class="toc-text">打包产出文件分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E9%A1%B5%E9%9D%A2%E5%BA%94%E7%94%A8"><span class="toc-number">15.</span> <span class="toc-text">多页面应用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#source-map%E7%9B%B8%E5%85%B3%E8%B0%83%E8%AF%95%E8%AE%BE%E7%BD%AE"><span class="toc-number">16.</span> <span class="toc-text">source-map相关调试设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#watch%E7%9A%84%E7%94%A8%E6%B3%95"><span class="toc-number">17.</span> <span class="toc-text">watch的用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#webpack3%E4%B8%AA%E5%B0%8F%E6%8F%92%E4%BB%B6"><span class="toc-number">18.</span> <span class="toc-text">webpack3个小插件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#webpack-%E8%B7%A8%E5%9F%9F"><span class="toc-number">19.</span> <span class="toc-text">webpack 跨域</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E6%9E%9C%E5%90%8E%E7%AB%AF%E7%BB%99%E7%9A%84%E8%AF%B7%E6%B1%82%E6%B2%A1%E6%9C%89API-%E3%80%8C%E8%B7%A8%E5%9F%9F%E3%80%8D"><span class="toc-number">20.</span> <span class="toc-text">如果后端给的请求没有API 「跨域」</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%AB%AFmock%E6%95%B0%E6%8D%AE-%E3%80%8C%E8%B7%A8%E5%9F%9F%E3%80%8D"><span class="toc-number">21.</span> <span class="toc-text">前端mock数据 「跨域」</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%89%E6%9C%8D%E5%8A%A1%E7%AB%AF%EF%BC%8C%E4%B8%8D%E7%94%A8%E4%BB%A3%E7%90%86-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%90%AF%E5%8A%A8webpack-%E3%80%8C%E8%B7%A8%E5%9F%9F%E3%80%8D"><span class="toc-number">22.</span> <span class="toc-text">有服务端，不用代理, 服务端启动webpack 「跨域」</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#webpack%E8%A7%A3%E6%9E%90resolve"><span class="toc-number">23.</span> <span class="toc-text">webpack解析resolve</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%86%E6%98%AF%E6%AF%8F%E6%AC%A1%E5%BC%95%E5%85%A5%E9%83%BD%E5%BE%88%E9%95%BF%EF%BC%8C%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E5%BC%95%E5%85%A5"><span class="toc-number">24.</span> <span class="toc-text">但是每次引入都很长，如何优雅引入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9C%81%E7%95%A5%E6%89%A9%E5%B1%95%E5%90%8D"><span class="toc-number">25.</span> <span class="toc-text">省略扩展名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">26.</span> <span class="toc-text">定义环境变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8C%BA%E5%88%86%E4%B8%A4%E4%B8%AA%E4%B8%8D%E5%90%8C%E7%9A%84%E7%8E%AF%E5%A2%83"><span class="toc-number">27.</span> <span class="toc-text">区分两个不同的环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#webpack-%E4%BC%98%E5%8C%96"><span class="toc-number">28.</span> <span class="toc-text">webpack 优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%EF%BC%9A%E5%BD%93%E6%9F%90%E4%BA%9B%E5%8C%85%E6%98%AF%E7%8B%AC%E7%AB%8B%E7%9A%84%E4%B8%AA%E4%BD%93%E6%B2%A1%E6%9C%89%E4%BE%9D%E8%B5%96"><span class="toc-number">29.</span> <span class="toc-text">优化：当某些包是独立的个体没有依赖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%EF%BC%9A%E8%A7%84%E5%88%99%E5%8C%B9%E9%85%8D%E8%AE%BE%E7%BD%AE%E8%8C%83%E5%9B%B4"><span class="toc-number">30.</span> <span class="toc-text">优化：规则匹配设置范围</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%EF%BC%9A%E5%BF%BD%E7%95%A5%E4%BE%9D%E8%B5%96%E4%B8%AD%E4%B8%8D%E5%BF%85%E8%A6%81%E7%9A%84%E8%AF%AD%E8%A8%80%E5%8C%85"><span class="toc-number">31.</span> <span class="toc-text">优化：忽略依赖中不必要的语言包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93"><span class="toc-number">32.</span> <span class="toc-text">动态链接库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%89%93%E5%8C%85happypack"><span class="toc-number">33.</span> <span class="toc-text">多线程打包happypack</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#webpack-%E8%87%AA%E5%B8%A6%E7%9A%84%E4%BC%98%E5%8C%96"><span class="toc-number">34.</span> <span class="toc-text">webpack 自带的优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%BD%E5%8F%96%E5%85%AC%E5%85%B1%E4%BB%A3%E7%A0%81"><span class="toc-number">35.</span> <span class="toc-text">抽取公共代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%87%92%E5%8A%A0%E8%BD%BD-%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD"><span class="toc-number">36.</span> <span class="toc-text">懒加载(延迟加载)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%83%AD%E6%9B%B4%E6%96%B0-%E5%BD%93%E9%A1%B5%E9%9D%A2%E6%94%B9%E5%8F%98%E5%8F%AA%E6%9B%B4%E6%96%B0%E6%94%B9%E5%8F%98%E7%9A%84%E9%83%A8%E5%88%86%EF%BC%8C%E4%B8%8D%E9%87%8D%E6%96%B0%E6%89%93%E5%8C%85"><span class="toc-number">37.</span> <span class="toc-text">热更新(当页面改变只更新改变的部分，不重新打包)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tapable%E4%BB%8B%E7%BB%8D-SyncHook"><span class="toc-number">38.</span> <span class="toc-text">tapable介绍 - SyncHook</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tapable%E4%BB%8B%E7%BB%8D-SyncBailHook"><span class="toc-number">39.</span> <span class="toc-text">tapable介绍 - SyncBailHook</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tapable%E4%BB%8B%E7%BB%8D-SyncWaterfallHook"><span class="toc-number">40.</span> <span class="toc-text">tapable介绍 - SyncWaterfallHook</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tapable%E4%BB%8B%E7%BB%8D-SyncLoopHook"><span class="toc-number">41.</span> <span class="toc-text">tapable介绍 - SyncLoopHook</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AsyncParallelHook-%E4%B8%8E-AsyncParallelBailHook"><span class="toc-number">42.</span> <span class="toc-text">AsyncParallelHook 与 AsyncParallelBailHook</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AsyncParallelHook"><span class="toc-number">42.0.1.</span> <span class="toc-text">AsyncParallelHook</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AsyncParallelBailHook"><span class="toc-number">42.0.2.</span> <span class="toc-text">AsyncParallelBailHook</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E4%B8%B2%E8%A1%8C-%E2%80%94%E2%80%94-AsyncSeriesHook"><span class="toc-number">43.</span> <span class="toc-text">异步串行 —— AsyncSeriesHook</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E4%B8%B2%E8%A1%8C-%E2%80%94%E2%80%94-AsyncSeriesWaterfallHook"><span class="toc-number">44.</span> <span class="toc-text">异步串行 —— AsyncSeriesWaterfallHook</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%8B%E5%86%99webpack"><span class="toc-number">45.</span> <span class="toc-text">手写webpack</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#webpack%E5%88%86%E6%9E%90%E5%8F%8A%E5%A4%84%E7%90%86"><span class="toc-number">46.</span> <span class="toc-text">webpack分析及处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB"><span class="toc-number">47.</span> <span class="toc-text">创建依赖关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ast%E9%80%92%E5%BD%92%E8%A7%A3%E6%9E%90"><span class="toc-number">48.</span> <span class="toc-text">ast递归解析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7"><span class="toc-number">49.</span> <span class="toc-text">生成打包工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0loader"><span class="toc-number">50.</span> <span class="toc-text">增加loader</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0plugins"><span class="toc-number">51.</span> <span class="toc-text">增加plugins</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#loader"><span class="toc-number">52.</span> <span class="toc-text">loader</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%A4%9A%E4%B8%AAloader"><span class="toc-number">53.</span> <span class="toc-text">配置多个loader</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#babel-loader%E5%AE%9E%E7%8E%B0"><span class="toc-number">54.</span> <span class="toc-text">babel-loader实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#banner-loader%E5%AE%9E%E7%8E%B0-%E8%87%AA%E5%88%9B"><span class="toc-number">55.</span> <span class="toc-text">banner-loader实现(自创)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0file-loader%E5%92%8Curl-loader"><span class="toc-number">56.</span> <span class="toc-text">实现file-loader和url-loader</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-loader%E5%92%8Ccss-loader"><span class="toc-number">57.</span> <span class="toc-text">less-loader和css-loader</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#css-loader"><span class="toc-number">58.</span> <span class="toc-text">css-loader</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#webpack-%E4%B8%AD%E7%9A%84%E6%8F%92%E4%BB%B6"><span class="toc-number">59.</span> <span class="toc-text">webpack 中的插件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%88%97%E8%A1%A8%E6%8F%92%E4%BB%B6"><span class="toc-number">60.</span> <span class="toc-text">文件列表插件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E8%81%94%E7%9A%84webpack%E6%8F%92%E4%BB%B6"><span class="toc-number">61.</span> <span class="toc-text">内联的webpack插件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%93%E5%8C%85%E5%90%8E%E8%87%AA%E5%8A%A8%E5%8F%91%E5%B8%83"><span class="toc-number">62.</span> <span class="toc-text">打包后自动发布</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%BB%AD%E8%BF%98%E6%9C%89%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0%EF%BC%81"><span class="toc-number">62.1.</span> <span class="toc-text">后续还有持续更新！</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/05/09/%E5%B7%A5%E4%BD%9C%E5%8F%82%E8%80%83/" title="各项参考"><img src="http://miaochen.mcweblog.com/img/wallhaven-4x76mz.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="各项参考"/></a><div class="content"><a class="title" href="/2022/05/09/%E5%B7%A5%E4%BD%9C%E5%8F%82%E8%80%83/" title="各项参考">各项参考</a><time datetime="2022-05-09T13:09:08.000Z" title="发表于 2022-05-09 21:09:08">2022-05-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/08/%E5%B7%A5%E4%BD%9C%E8%B5%84%E6%96%99%E5%A4%87%E9%98%85/" title="工作相关"><img src="https://w.wallhaven.cc/full/r2/wallhaven-r211q1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="工作相关"/></a><div class="content"><a class="title" href="/2022/05/08/%E5%B7%A5%E4%BD%9C%E8%B5%84%E6%96%99%E5%A4%87%E9%98%85/" title="工作相关">工作相关</a><time datetime="2022-05-08T06:50:42.000Z" title="发表于 2022-05-08 14:50:42">2022-05-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/10/30/%E5%90%84%E7%A7%8D%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/" title="各种问题总结 😓"><img src="http://miaochen.mcweblog.com/img/202203282025457.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="各种问题总结 😓"/></a><div class="content"><a class="title" href="/2020/10/30/%E5%90%84%E7%A7%8D%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/" title="各种问题总结 😓">各种问题总结 😓</a><time datetime="2020-10-30T08:25:43.000Z" title="发表于 2020-10-30 16:25:43">2020-10-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/06/05/%E7%B3%BB%E7%BB%9Fapi/" title="系统API"><img src="https://miaochen.mcweblog.com/img%2Fwq5m26.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="系统API"/></a><div class="content"><a class="title" href="/2020/06/05/%E7%B3%BB%E7%BB%9Fapi/" title="系统API">系统API</a><time datetime="2020-06-05T13:46:28.000Z" title="发表于 2020-06-05 21:46:28">2020-06-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2019/10/17/blog/" title="博客整体搭建流程"><img src="https://miaochen.mcweblog.com/img%2Fwq5m26.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="博客整体搭建流程"/></a><div class="content"><a class="title" href="/2019/10/17/blog/" title="博客整体搭建流程">博客整体搭建流程</a><time datetime="2019-10-17T02:37:32.000Z" title="发表于 2019-10-17 10:37:32">2019-10-17</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://miaochen.mcweblog.com/img%2Fwq5m26.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Mc</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi,  welcome  to  my  <a  target="_blank" rel="noopener" href="https://mcweblog.gitee.io/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'UipdkIx78Se1ldhBUTMUbKNI-gzGzoHsz',
      appKey: 'VnOXxB6sC8ORtP3Enqd16rIF',
      avatar: 'mp',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"left","width":145,"height":315},"mobile":{"show":false,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.8},"log":false});</script></body></html>